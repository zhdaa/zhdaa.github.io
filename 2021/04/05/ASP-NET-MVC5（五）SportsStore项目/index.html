<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zhendong在github上的个人博客">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="alternate" type="application/atom+xml" title="Zhendong" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        ASP.NET MVC5（五）SportsStore项目｜Zhendong&#39;s blog
        
    </title>

    <link rel="canonical" href="https://zhdaa.github.io/2021/04/05/ASP-NET-MVC5（五）SportsStore项目/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('/images/zhdaa-headimg.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Zhendong
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/images/post-ocean.jpg">


<style>
    
    header.intro-header {
        background-image: url('/images/post-ocean.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>ASP.NET MVC5（五）SportsStore项目</h1>
                    
                    <span class="meta">
                         作者 Zhendong Ho
                        <span>
                          日期 2021-04-05
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#ASP.NET MVC"
                           title="ASP.NET MVC">ASP.NET MVC</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            ASP.NET MVC5（五）SportsStore项目
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>该应用程序的名称为<strong>SportStore</strong>，它遵循<strong>在线商店</strong>所采取的经典方式。包含以下功能。</p>
<ul>
<li>产品分类。客户可以通过分类和页面进行浏览。</li>
<li>商品购物车。客户可以添加或删除商品。</li>
<li>结算页面。客户输入其邮寄地址的细节。</li>
<li>管理区。包含管理产品分类所需的CRUD功能，并且只有管理员才能操作。</li>
</ul>
<h3 id="创建VS解决方案和项目。"><a href="#创建VS解决方案和项目。" class="headerlink" title="创建VS解决方案和项目。"></a>创建VS解决方案和项目。</h3><p>创建一个<strong>解决方案</strong>，且包含有<strong>3个项目</strong>：<strong>域模型项目</strong>、<strong>MVC应用程序项目</strong>、<strong>单元测试项目</strong>。</p>
<p>打开VS，创建<strong>空解决方案</strong>，名称为<strong>SportsStore</strong>。然后添加3个项目。</p>
<table>
<thead>
<tr>
<th>项目名称</th>
<th>VS项目模板</th>
<th>目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>SportsStore.Domain</td>
<td>类库</td>
<td>存放域实体与逻辑，通过EF创建的存储库来建立持久化</td>
</tr>
<tr>
<td>SportsStore.WebUI</td>
<td>ASP.NET MVC Web应用程序（空模板）</td>
<td>存放控制器与视图，充当SportsStore应用程序的UI</td>
</tr>
<tr>
<td>SportsStore.UnitTests</td>
<td>测试项目</td>
<td>存放用于上述两个项目的单元测试</td>
</tr>
</tbody>
</table>
<p>创建完成3个项目后，做以下几件事。</p>
<ul>
<li>删除SportsStore.Domain项目中的Class1.cs文件。</li>
<li>把SportsStore.WebUI项目，设置为<strong>启动项目</strong>。</li>
<li>打开SportsStore.WebUI项目的属性页，勾选<strong>特定页</strong>选项，但文本框不需要输入值。这样，启动调试后，将直接请求应用程序的根URL。</li>
</ul>
<h3 id="安装工具包"><a href="#安装工具包" class="headerlink" title="安装工具包"></a>安装工具包</h3><p>打开Nuget命令行窗口。输入以下命令。</p>
<ul>
<li>Install-Package Ninject -version 3.0.1.10 -projectname SportsStore.WebUI</li>
<li>Install-Package Ninject.Web.Common -version 3.0.0.7 -projectname SportsStore.WebUI</li>
<li>Install-Package Ninject.MVC3 -version 3.0.0.6 -projectname SportsStore.WebUI</li>
<li>Install-Package Ninject -version 3.0.1.10 -projectname SportsStore.UnitTests</li>
<li>Install-Package Ninject.Web.Common -version 3.0.0.7 -projectname SportsStore.UnitTests</li>
<li>Install-Package Ninject.MVC3 -version 3.0.0.6 -projectname SportsStore.UnitTests</li>
<li>Install-Package Moq -version 4.1.1309.1617 -projectname SportsStore.WebUI</li>
<li>Install-Package Moq -version 4.1.1309.1617 -projectname SportsStore.UnitTests</li>
<li>Install-Package Microsoft.Aspnet.Mvc -version 5.0.0 -projectname SportsStore.Domain</li>
<li>Install-Package Microsoft.Aspnet.Mvc -version 5.0.0 -projectname SportsStore.UnitTests</li>
</ul>
<h3 id="添加项目之间的引用"><a href="#添加项目之间的引用" class="headerlink" title="添加项目之间的引用"></a>添加项目之间的引用</h3><table>
<thead>
<tr>
<th>项目名</th>
<th>解决方案依赖项</th>
<th>程序集引用</th>
</tr>
</thead>
<tbody>
<tr>
<td>SportsStore.Domain</td>
<td>None</td>
<td>System.ComponentModel.DataAnnotations</td>
</tr>
<tr>
<td>SportsStore.WebUI</td>
<td>SportsStore.Domain</td>
<td>None</td>
</tr>
<tr>
<td>SportsStore.UnitTests</td>
<td>SportsStore.Domain<br>SportsStore.WebUI</td>
<td>System.Web<br>Microsoft.CSharp</td>
</tr>
</tbody>
</table>
<h3 id="设置DI容器"><a href="#设置DI容器" class="headerlink" title="设置DI容器"></a>设置DI容器</h3><p>在<strong>SportsStore.WebUI</strong>项目添加<strong>Infrastructure文件夹</strong>，在其中添加<strong>NinjectDependencyResolver.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NinjectDependencyResolver</span> : <span class="title">IDependencyResolver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IKernel kernel;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NinjectDependencyResolver</span>(<span class="params">IKernel kernelParamm</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        kernel = kernelParamm;</span><br><span class="line">        AddBindings();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> kernel.TryGet(serviceType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="keyword">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> kernel.GetAll(serviceType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddBindings</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 将绑定放在这里</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改App_Start文件夹中的<strong>NinjectWebCommon.cs</strong>文件，集成Ninject。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Load your modules or register your services here!</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="kernel"&gt;</span>The kernel.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IKernel kernel</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    System.Web.Mvc.DependencyResolver.SetResolver(<span class="keyword">new</span> Infrastructure.NinjectDependencyResolver(kernel));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="从域模型开始"><a href="#从域模型开始" class="headerlink" title="从域模型开始"></a>从域模型开始</h2><p>在<strong>SportsStore.Domain项目</strong>中，添加<strong>Entities文件夹</strong>，添加<strong>Product.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Product</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ProductID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Description &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Category &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建抽象存储库"><a href="#创建抽象存储库" class="headerlink" title="创建抽象存储库"></a>创建抽象存储库</h3><p><strong>存储库模式</strong>用于从持久化数据库中存储和接收数据。</p>
<p>在<strong>SportsStore.Domain项目</strong>中，创建<strong>Abstract文件夹</strong>，添加<strong>IProductsRepository.cs</strong>接口。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IProductRepository</span></span><br><span class="line">&#123;</span><br><span class="line">    IEnumerable&lt;Product&gt; Products &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>IQueryable&lt;T&gt;接口继承了IEnumerable&lt;T&gt;接口。一个类可以依靠IProductRepository接口<strong>获取Product对象</strong>，而不必知道这些对象从哪儿来，也不必知道接口如何实现，这就是<strong>存储库模式</strong>的本质。</p>
<h3 id="创建模仿存储库"><a href="#创建模仿存储库" class="headerlink" title="创建模仿存储库"></a>创建模仿存储库</h3><p>创建<strong>IProductRepository接口</strong>的<strong>模仿实现</strong>，直到使用数据库时，再替换这些存储库模仿实现。</p>
<p>在SportsStore.WebUI项目的<strong>NinjectDependencyResolver类</strong>的<strong>AddBindings方法</strong>定义模仿实现，并<strong>绑定</strong>到<strong>IProductRepository接口</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddBindings</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将绑定放在这里</span></span><br><span class="line">    Mock&lt;IProductRepository&gt; mock = <span class="keyword">new</span> Mock&lt;IProductRepository&gt;();</span><br><span class="line">    mock.Setup(m =&gt; m.Products).Returns(<span class="keyword">new</span> List&lt;Product&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> Product &#123; Name = <span class="string">"Football"</span>, Price = <span class="number">25</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; Name = <span class="string">"Surf board"</span>, Price = <span class="number">179</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; Name = <span class="string">"Running shoes"</span>, Price = <span class="number">95</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    kernel.Bind&lt;IProductRepository&gt;().ToConstant(mock.Object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ToConstant方法</strong>设置了Ninject的<strong>作用域</strong>。每次接收到IProductRepository接口实现的请求时，返回的都是<strong>同样的模仿对象</strong>。</p>
<h2 id="显示产品列表"><a href="#显示产品列表" class="headerlink" title="显示产品列表"></a>显示产品列表</h2><h3 id="添加控制器"><a href="#添加控制器" class="headerlink" title="添加控制器"></a>添加控制器</h3><p>在<strong>SportsStore.WebUI项目</strong>中，添加<strong>ProductController</strong>控制器。其中构造器中声明了一个<strong>对IProductRepository接口的依赖项</strong>，并添加<strong>List动作方法</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductController</span> : <span class="title">Controller</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IProductRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProductController</span>(<span class="params">IProductRepository productRepository</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        repository = productRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResult <span class="title">List</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> View(repository.Products);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加布局、视图起始文件及视图"><a href="#添加布局、视图起始文件及视图" class="headerlink" title="添加布局、视图起始文件及视图"></a>添加布局、视图起始文件及视图</h3><p>右键<strong>List动作方法</strong>，添加<strong>List视图</strong>，选择<strong>空模板</strong>，选择<strong>Product</strong>模型类，选择<strong>使用布局页</strong>。</p>
<p>修改<strong>_Layout.cshtml</strong>文件代码如下。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>@ViewBag.Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    @RenderBody()</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改<strong>List视图</strong>代码如下。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@using SportsStore.Domain.Entities</span><br><span class="line">@model IEnumerable<span class="tag">&lt;<span class="name">Product</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@&#123;</span><br><span class="line">    ViewBag.Title = "Products";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@foreach (var p in Model)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@p.Name<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        @p.Description</span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>@p.Price.ToString("c")<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，<strong>ToString(“c”)方法</strong>，将Price属性转换成一个字符串，根据<strong>服务器的语言</strong>，渲染成<strong>货币形式</strong>。也可以修改服务器的语言设置，只要把<strong>&lt;globalization culture=”fr-FR” uiCulture=”fr-FR” /&gt;</strong>添加到<strong>web.config</strong>的<strong>&lt;system.web&gt;结点</strong>即可。</p>
<h4 id="设置默认路由"><a href="#设置默认路由" class="headerlink" title="设置默认路由"></a>设置默认路由</h4><p>应该将应用程序<strong>根URL</strong>的请求发送给<strong>ProductController</strong>的<strong>List动作方法</strong>。修改<strong>RouteConfig.cs</strong>文件，将Home改成Product，将Index改成List。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterRoutes</span>(<span class="params">RouteCollection routes</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    routes.IgnoreRoute(<span class="string">"&#123;resource&#125;.axd/&#123;*pathInfo&#125;"</span>);</span><br><span class="line"></span><br><span class="line">    routes.MapRoute(</span><br><span class="line">        name: <span class="string">"Default"</span>,</span><br><span class="line">        url: <span class="string">"&#123;controller&#125;/&#123;action&#125;/&#123;id&#125;"</span>,</span><br><span class="line">        defaults: <span class="keyword">new</span> &#123; controller = <span class="string">"Product"</span>, action = <span class="string">"List"</span>, id = UrlParameter.Optional &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运行应用程序"><a href="#运行应用程序" class="headerlink" title="运行应用程序"></a>运行应用程序</h3><p>页面正常显示。</p>
<h2 id="准备数据库"><a href="#准备数据库" class="headerlink" title="准备数据库"></a>准备数据库</h2><p>数据库使用<strong>SQLServer</strong>，并用<strong>Entity Framework</strong>来访问数据库。</p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>打开SSMS，创建数据库<strong>SportsStore</strong>，创建表<strong>Products</strong>，并插入数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> SportsStore</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Products</span><br><span class="line">(</span><br><span class="line">    [ProductID] <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> <span class="keyword">identity</span>,</span><br><span class="line">    [<span class="keyword">Name</span>] <span class="keyword">nvarchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    [Description] <span class="keyword">nvarchar</span>(<span class="number">500</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    [<span class="keyword">Category</span>] <span class="keyword">nvarchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    [Price] <span class="built_in">decimal</span>(<span class="number">16</span>, <span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Products(<span class="keyword">Name</span>, Description, <span class="keyword">Category</span>, Price)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">'Kakak'</span>, <span class="string">'A boat for one person'</span>, <span class="string">'Watersports'</span>, <span class="number">275</span>),</span><br><span class="line">(<span class="string">'Lifejacket'</span>, <span class="string">'Protective and fashionable'</span>, <span class="string">'Watersports'</span>, <span class="number">48.95</span>),</span><br><span class="line">(<span class="string">'Soccer Ball'</span>, <span class="string">'FIFA-approved size and weight'</span>, <span class="string">'Soccer'</span>, <span class="number">19.50</span>),</span><br><span class="line">(<span class="string">'Corner Flags'</span>, <span class="string">'Give your playing field a professional touch'</span>, <span class="string">'Soccer'</span>, <span class="number">34.95</span>),</span><br><span class="line">(<span class="string">'Stadium'</span>, <span class="string">'Flat-packed 35,000-seat stadium'</span>, <span class="string">'Soccer'</span>, <span class="number">79500.00</span>),</span><br><span class="line">(<span class="string">'Thinking Cap'</span>, <span class="string">'Improve your brain efficiency'</span>, <span class="string">'Chess'</span>, <span class="number">16.00</span>),</span><br><span class="line">(<span class="string">'Unsteady Chair'</span>, <span class="string">'Secretly give your opponent a disadvantage'</span>, <span class="string">'Chess'</span>, <span class="number">29.95</span>),</span><br><span class="line">(<span class="string">'Human Chess Board'</span>, <span class="string">'A fun game for the family'</span>, <span class="string">'Chess'</span>, <span class="number">75.00</span>),</span><br><span class="line">(<span class="string">'Bling-Bling King'</span>, <span class="string">'Gold-plated, diamond-studded King'</span>, <span class="string">'Chess'</span>, <span class="number">1200</span>)</span><br></pre></td></tr></table></figure>
<h3 id="创建Entity-Framework上下文"><a href="#创建Entity-Framework上下文" class="headerlink" title="创建Entity Framework上下文"></a>创建Entity Framework上下文</h3><h4 id="安装EF"><a href="#安装EF" class="headerlink" title="安装EF"></a>安装EF</h4><p>打开Nuget命令行，输入命令安装EF。</p>
<ul>
<li>Install-Package EntityFramework -projectname SportsStore.Domain</li>
<li>Install-Package EntityFramework -projectname SportsStore.WebUI</li>
</ul>
<h4 id="创建上下文类"><a href="#创建上下文类" class="headerlink" title="创建上下文类"></a>创建上下文类</h4><p>创建<strong>上下文类</strong>，以便模型与数据库关联起来。在<strong>SportsStore.Domain项目</strong>中创建<strong>Concrete文件夹</strong>，并添加<strong>EFDbContext.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EFDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DbSet&lt;Product&gt; Products &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li>为了利用<strong>code-first特性</strong>，需要创建一个<strong>派生于System.Data.Entity.DbContext的类</strong>，该类会为数据库中的每个表<strong>自动定义一个属性</strong>。</li>
<li>属性名称为<strong>数据表名</strong>。而<strong>DbSet</strong>结果的类型参数为<strong>模型类型</strong>。</li>
</ul>
<h4 id="配置EF连接数据库"><a href="#配置EF连接数据库" class="headerlink" title="配置EF连接数据库"></a>配置EF连接数据库</h4><p>在<strong>SportsStore.WebUI项目</strong>中，修改<strong>web.config</strong>文件。该<strong>连接字符串的名称</strong>与这个<strong>上下文类的名称</strong>相同。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"EFDbContext"</span> <span class="attr">connectionString</span>=<span class="string">"Data Source=.;Initial Catalog=SportsStore;Integrated Security=True"</span> <span class="attr">providerName</span>=<span class="string">"System.Data.SqlClient"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建Product存储库"><a href="#创建Product存储库" class="headerlink" title="创建Product存储库"></a>创建Product存储库</h3><p>在<strong>Concrete文件夹</strong>下，添加<strong>EFProductRepository.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EFProductRepository</span> : <span class="title">IProductRepository</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> EFDbContext context = <span class="keyword">new</span> EFDbContext();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IEnumerable&lt;Product&gt; Products</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> context.Products; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：存储库类实现了<strong>IProductRepository接口</strong>，并使用一个<strong>EFDbContext实例</strong>，以便用<strong>EF</strong>接收数据库的数据。</p>
<p>修改<strong>NinjectDependencyResolver.cs</strong>文件中的绑定，用<strong>实际存储库</strong>绑定<strong>替换</strong>之前的<strong>模仿存储库</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddBindings</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    kernel.Bind&lt;IProductRepository&gt;().To&lt;EFProductRepository&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行项目，可以看到应用程序从<strong>数据库</strong>，而不是从<strong>模仿存储库</strong>得到了产品数据。</p>
<h2 id="添加分页"><a href="#添加分页" class="headerlink" title="添加分页"></a>添加分页</h2><h3 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h3><p>在<strong>ProductController</strong>中的<strong>List</strong>动作方法添加一个<strong>分页参数</strong>，实现分页功能。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductController</span> : <span class="title">Controller</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> PageSize = <span class="number">4</span>;	<span class="comment">// 每页显示的条目数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResult <span class="title">List</span>(<span class="params"><span class="keyword">int</span> page = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> View(</span><br><span class="line">            repository.Products</span><br><span class="line">            .OrderBy(p =&gt; p.ProductID)</span><br><span class="line">            .Skip((page - <span class="number">1</span>) * PageSize)</span><br><span class="line">            .Take(PageSize));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单元测试：分页"><a href="#单元测试：分页" class="headerlink" title="单元测试：分页"></a>单元测试：分页</h4><p>在单元测试项目的<strong>UnitTest1.cs</strong>文件创建单元测试。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestClass</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnitTest1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Can_Paginate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 准备</span></span><br><span class="line">        Mock&lt;IProductRepository&gt; mock = <span class="keyword">new</span> Mock&lt;IProductRepository&gt;();</span><br><span class="line">        mock.Setup(m =&gt; m.Products).Returns(<span class="keyword">new</span> Product[] &#123;</span><br><span class="line">            <span class="keyword">new</span> Product &#123; ProductID = <span class="number">1</span>, Name = <span class="string">"P1"</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Product &#123; ProductID = <span class="number">2</span>, Name = <span class="string">"P2"</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Product &#123; ProductID = <span class="number">3</span>, Name = <span class="string">"P3"</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Product &#123; ProductID = <span class="number">4</span>, Name = <span class="string">"P4"</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Product &#123; ProductID = <span class="number">5</span>, Name = <span class="string">"P5"</span> &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ProductController controller = <span class="keyword">new</span> ProductController(mock.Object);</span><br><span class="line">        controller.PageSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动作</span></span><br><span class="line">        IEnumerable&lt;Product&gt; result = (IEnumerable&lt;Product&gt;)controller.List(<span class="number">2</span>).Model;	<span class="comment">// 调用Model属性获取控制器返回的数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 断言</span></span><br><span class="line">        Product[] prodArray = result.ToArray();</span><br><span class="line">        Assert.IsTrue(prodArray.Length == <span class="number">2</span>);</span><br><span class="line">        Assert.AreEqual(prodArray[<span class="number">0</span>].Name, <span class="string">"P4"</span>);</span><br><span class="line">        Assert.AreEqual(prodArray[<span class="number">1</span>].Name, <span class="string">"P5"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：获取控制器返回的数据很容易。在结果上调用<strong>Model属性</strong>，就可以得到在<strong>List方法</strong>中生成的<strong>IEnumerable&lt;Product&gt;序列</strong>。</p>
<h3 id="显示页面链接"><a href="#显示页面链接" class="headerlink" title="显示页面链接"></a>显示页面链接</h3><p>运行项目，通过修改<strong><a href="https://localhost:44328/?page=1" target="_blank" rel="noopener">https://localhost:44328/?page=1</a></strong>链接中的<strong>page参数</strong>来切换分页。</p>
<p>这样很不方便。因此，需要在每个产品列表的底部渲染某种页面链接，让客户能够在页面之间进行导航。</p>
<h4 id="添加视图模型"><a href="#添加视图模型" class="headerlink" title="添加视图模型"></a>添加视图模型</h4><p>在SportsStore.WebUI项目中的<strong>Models文件夹</strong>，添加<strong>PagingInfo.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PagingInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储库中的产品总数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> TotalItems &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 每页产品数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ItemsPerPage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 当前页</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CurrentPage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 可用页面数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> TotalPages</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> (<span class="keyword">int</span>)Math.Ceiling((<span class="keyword">decimal</span>)TotalItems / ItemsPerPage); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<strong>视图模型</strong>不属于域模型，它只是一种便于<strong>在控制器与视图之间传递数据</strong>的类。因此，把<strong>PagingInfo类</strong>放在MVC框架项目的<strong>Models文件夹</strong>。</p>
<h4 id="添加HTML辅助器方法"><a href="#添加HTML辅助器方法" class="headerlink" title="添加HTML辅助器方法"></a>添加HTML辅助器方法</h4><p>在SportsStore.WebUI项目中，创建<strong>HtmlHelpers文件夹</strong>，并添加<strong>PagingHelpers.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">PagingHelpers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MvcHtmlString <span class="title">PageLinks</span>(<span class="params"><span class="keyword">this</span> HtmlHelper html, PagingInfo pagingInfo, Func&lt;<span class="keyword">int</span>, <span class="keyword">string</span>&gt; pageUrl</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= pagingInfo.TotalPages; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            TagBuilder tag = <span class="keyword">new</span> TagBuilder(<span class="string">"a"</span>);</span><br><span class="line">            tag.MergeAttribute(<span class="string">"href"</span>, pageUrl(i));</span><br><span class="line">            tag.InnerHtml = i.ToString();</span><br><span class="line">            <span class="keyword">if</span> (i == pagingInfo.CurrentPage)</span><br><span class="line">            &#123;</span><br><span class="line">                tag.AddCssClass(<span class="string">"selected"</span>);</span><br><span class="line">                tag.AddCssClass(<span class="string">"btn-primary"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            tag.AddCssClass(<span class="string">"btn btn-default"</span>);</span><br><span class="line">            result.Append(tag.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> MvcHtmlString.Create(result.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<strong>PageLinks扩展方法</strong>是用<strong>PagingInfo</strong>对象提供的信息<strong>生成</strong>一组页面链接的<strong>HTML标记</strong>。</p>
<h4 id="单元测试：创建页面链接"><a href="#单元测试：创建页面链接" class="headerlink" title="单元测试：创建页面链接"></a>单元测试：创建页面链接</h4><p>在单元测试中，新增测试方法，测试<strong>PageLinks辅助器方法</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestMethod</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Can_Generate_Page_Links</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 准备 - 定义一个HTML辅助器，这是必须的，目的是运用扩展方法</span></span><br><span class="line">    HtmlHelper myHelper = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备 - 创建PagingInfo数据</span></span><br><span class="line">    PagingInfo pagingInfo = <span class="keyword">new</span> PagingInfo</span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = <span class="number">2</span>,</span><br><span class="line">        TotalItems = <span class="number">28</span>,</span><br><span class="line">        ItemsPerPage = <span class="number">10</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备 - 使用lambda表达式建立委托</span></span><br><span class="line">    Func&lt;<span class="keyword">int</span>, <span class="keyword">string</span>&gt; pageUrlDelegate = i =&gt; <span class="string">"Page"</span> + i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动作</span></span><br><span class="line">    MvcHtmlString result = myHelper.PageLinks(pagingInfo, pageUrlDelegate);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言</span></span><br><span class="line">    Assert.AreEqual(<span class="string">@"&lt;a class=""btn btn-default"" href=""Page1""&gt;1&lt;/a&gt;"</span></span><br><span class="line">                    + <span class="string">@"&lt;a class=""btn btn-default btn-primary selected"" href=""Page2""&gt;2&lt;/a&gt;"</span></span><br><span class="line">                    + <span class="string">@"&lt;a class=""btn btn-default"" href=""Page3""&gt;3&lt;/a&gt;"</span>, result.ToString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="添加视图的模型数据"><a href="#添加视图的模型数据" class="headerlink" title="添加视图的模型数据"></a>添加视图的模型数据</h4><p>在SportsStore.WebUI项目的<strong>Models文件夹</strong>中，添加<strong>ProductsListViewModel.cs</strong>文件。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsListViewModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> IEnumerable&lt;Product&gt; Products &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> PagingInfo PagingInfo &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<strong>ProductController</strong>中的<strong>List动作方法</strong>，将<strong>ProductsListViewModel</strong>类传给视图。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ViewResult <span class="title">List</span>(<span class="params"><span class="keyword">int</span> page = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ProductsListViewModel model = <span class="keyword">new</span> ProductsListViewModel</span><br><span class="line">    &#123;</span><br><span class="line">        Products = repository.Products</span><br><span class="line">            .OrderBy(p =&gt; p.ProductID)</span><br><span class="line">            .Skip((page - <span class="number">1</span>) * PageSize)</span><br><span class="line">            .Take(PageSize),</span><br><span class="line">        PagingInfo = <span class="keyword">new</span> PagingInfo</span><br><span class="line">        &#123;</span><br><span class="line">            CurrentPage = page,</span><br><span class="line">            ItemsPerPage = PageSize,</span><br><span class="line">            TotalItems = repository.Products.Count()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> View(model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单元测试：页面模型视图数据"><a href="#单元测试：页面模型视图数据" class="headerlink" title="单元测试：页面模型视图数据"></a>单元测试：页面模型视图数据</h4><p>为了确保控制器向视图发送正确的分页数据，在单元测试添加新的测试方法。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestMethod</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Can_Send_Pagination_View_Model</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 准备</span></span><br><span class="line">    Mock&lt;IProductRepository&gt; mock = <span class="keyword">new</span> Mock&lt;IProductRepository&gt;();</span><br><span class="line">    mock.Setup(m =&gt; m.Products).Returns(<span class="keyword">new</span> Product[] &#123;</span><br><span class="line">        <span class="keyword">new</span> Product &#123; ProductID = <span class="number">1</span>, Name = <span class="string">"P1"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; ProductID = <span class="number">2</span>, Name = <span class="string">"P2"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; ProductID = <span class="number">3</span>, Name = <span class="string">"P3"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; ProductID = <span class="number">4</span>, Name = <span class="string">"P4"</span> &#125;,</span><br><span class="line">        <span class="keyword">new</span> Product &#123; ProductID = <span class="number">5</span>, Name = <span class="string">"P5"</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备</span></span><br><span class="line">    ProductController controller = <span class="keyword">new</span> ProductController(mock.Object);</span><br><span class="line">    controller.PageSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动作</span></span><br><span class="line">    ProductsListViewModel result = (ProductsListViewModel)controller.List(<span class="number">2</span>).Model;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言</span></span><br><span class="line">    PagingInfo pageInfo = result.PagingInfo;</span><br><span class="line">    Assert.AreEqual(pageInfo.CurrentPage, <span class="number">2</span>);</span><br><span class="line">    Assert.AreEqual(pageInfo.ItemsPerPage, <span class="number">3</span>);</span><br><span class="line">    Assert.AreEqual(pageInfo.TotalItems, <span class="number">5</span>);</span><br><span class="line">    Assert.AreEqual(pageInfo.TotalPages, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>PS</strong>：由于修改了List动作方法传给视图的模型，因此对应的测试方法<strong>Can_Paginate</strong>也需要做出相应修改。并且更新<strong>List视图</strong>中的<strong>@model</strong>。</p>
<h4 id="显示页面链接-1"><a href="#显示页面链接-1" class="headerlink" title="显示页面链接"></a>显示页面链接</h4><p>在<strong>List视图</strong>中调用<strong>HTML辅助器方法</strong>。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@using SportsStore.WebUI.HtmlHelpers</span><br><span class="line">@model SportsStore.WebUI.Models.ProductsListViewModel</span><br><span class="line"></span><br><span class="line">@&#123;</span><br><span class="line">    ViewBag.Title = "Products";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@foreach (var p in Model.Products)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@p.Name<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        @p.Description</span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>@p.Price.ToString("c")<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("List", new &#123; page = x &#125;))</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：只有当包含扩展方法的命名空间在范围内时，其中的扩展方法才是可用的。</p>
<ul>
<li>一种方法是在<strong>视图文件</strong>中使用<strong>@using语句</strong>，如List视图代码中的第一行。</li>
<li>另一种方法是在<strong>Views/Web.config配置文件</strong>中，添加HTML辅助器方法的<strong>命名空间</strong>，这样就可以去掉视图中的@using。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.web.webPages.razor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">host</span> <span class="attr">factoryType</span>=<span class="string">"System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.7.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pages</span> <span class="attr">pageBaseType</span>=<span class="string">"System.Web.Mvc.WebViewPage"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">namespaces</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"System.Web.Mvc"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"System.Web.Mvc.Ajax"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"System.Web.Mvc.Html"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"System.Web.Routing"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"SportsStore.WebUI"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">namespace</span>=<span class="string">"SportsStore.WebUI.HtmlHelpers"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">namespaces</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pages</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.web.webPages.razor</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行应用程序，可以看到，产品列表下方有<strong>分页链接</strong>。</p>
<h3 id="改进URL"><a href="#改进URL" class="headerlink" title="改进URL"></a>改进URL</h3><p>目前的链接使用的是<strong>查询字符串</strong>形式，如：<a href="http://localhost/?page=2。" target="_blank" rel="noopener">http://localhost/?page=2。</a><br>可以根据<strong>可组合URL</strong>模式创建一种对用户有意义的URL形式。如：<a href="http://localhost/Page2。" target="_blank" rel="noopener">http://localhost/Page2。</a></p>
<p>修改<strong>RouteConfig.cs</strong>文件的<strong>RegisterRoutes方法</strong>，添加一条新的路由。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RouteConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterRoutes</span>(<span class="params">RouteCollection routes</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        routes.IgnoreRoute(<span class="string">"&#123;resource&#125;.axd/&#123;*pathInfo&#125;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 该路由必须在Default路由之前，该路由优先于Default路由</span></span><br><span class="line">        routes.MapRoute(</span><br><span class="line">            name: <span class="literal">null</span>,</span><br><span class="line">            url: <span class="string">"Page&#123;page&#125;"</span>,</span><br><span class="line">            defaults: <span class="keyword">new</span> &#123; controller = <span class="string">"Product"</span>, action = <span class="string">"List"</span> &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        routes.MapRoute(</span><br><span class="line">            name: <span class="string">"Default"</span>,</span><br><span class="line">            url: <span class="string">"&#123;controller&#125;/&#123;action&#125;/&#123;id&#125;"</span>,</span><br><span class="line">            defaults: <span class="keyword">new</span> &#123; controller = <span class="string">"Product"</span>, action = <span class="string">"List"</span>, id = UrlParameter.Optional &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行应用程序，并导航到一个页面，可以看到新的URL方案已生效。</p>
<h2 id="设置内容样式"><a href="#设置内容样式" class="headerlink" title="设置内容样式"></a>设置内容样式</h2><h3 id="安装Bootstrap包"><a href="#安装Bootstrap包" class="headerlink" title="安装Bootstrap包"></a>安装Bootstrap包</h3><p>输入Nuget命令：Install-Package -version 3.0.0 bootstrap -projectname SportsStore.WebUI</p>
<h3 id="在布局中运用Bootstrap样式"><a href="#在布局中运用Bootstrap样式" class="headerlink" title="在布局中运用Bootstrap样式"></a>在布局中运用Bootstrap样式</h3><p>修改<strong>_Layout.cshtml</strong>文件，添加Bootstrap样式。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"~/Content/bootstrap.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"~/Content/bootstrap-theme.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>@ViewBag.Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>SPORTS STORE<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row panel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"categories"</span> <span class="attr">class</span>=<span class="string">"col-xs-3"</span>&gt;</span></span><br><span class="line">            Put something useful here later</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8"</span>&gt;</span></span><br><span class="line">            @RenderBody()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改<strong>List.cshtml</strong>文件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@model SportsStore.WebUI.Models.ProductsListViewModel</span><br><span class="line"></span><br><span class="line">@&#123;</span><br><span class="line">    ViewBag.Title = "Products";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@foreach (var p in Model.Products)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">strong</span>&gt;</span>@p.Name<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right label label-primary"</span>&gt;</span>@p.Price.ToString("c")<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>@p.Description<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-group pull-right"</span>&gt;</span></span><br><span class="line">    @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("List", new &#123; page = x &#125;))</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建分部视图"><a href="#创建分部视图" class="headerlink" title="创建分部视图"></a>创建分部视图</h3><p><strong>分部视图</strong>是嵌入到另一个视图中的一个<strong>内容片段</strong>，而不是一个模板。它是一种自包含的文件，且可以跨视图重用，有助于<strong>减少重复</strong>。</p>
<p>右键SportsStore.WebUI项目的<strong>/Views/Shared文件夹</strong>，点击<strong>添加视图</strong>。选择<strong>空模板</strong>，模型类选择<strong>Product</strong>，并勾选<strong>创建为分部视图</strong>，命名为<strong>ProductSummary</strong>。</p>
<p>在<strong>ProductSummary</strong>分部视图中添加标记。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@model SportsStore.Domain.Entities.Product</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>@Model.Name<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right label label-primary"</span>&gt;</span>@Model.Price.ToString("c")<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>@Model.Description<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改<strong>List</strong>视图，使用<strong>ProductSummary</strong>分部视图去掉foreach循环中的重复标记。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@model SportsStore.WebUI.Models.ProductsListViewModel</span><br><span class="line"></span><br><span class="line">@&#123;</span><br><span class="line">    ViewBag.Title = "Products";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@foreach (var p in Model.Products)</span><br><span class="line">&#123;</span><br><span class="line">    @Html.Partial("ProductSummary", p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-group pull-right"</span>&gt;</span></span><br><span class="line">    @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("List", new &#123; page = x &#125;))</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

                <hr>
                

                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/2021/03/26/ASP-NET-MVC5（四）MVC基本工具/" data-toggle="tooltip" data-placement="top"
                           title="ASP.NET MVC5（四）MVC基本工具">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#开始"><span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建VS解决方案和项目。"><span class="toc-text">创建VS解决方案和项目。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装工具包"><span class="toc-text">安装工具包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加项目之间的引用"><span class="toc-text">添加项目之间的引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置DI容器"><span class="toc-text">设置DI容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从域模型开始"><span class="toc-text">从域模型开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建抽象存储库"><span class="toc-text">创建抽象存储库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建模仿存储库"><span class="toc-text">创建模仿存储库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示产品列表"><span class="toc-text">显示产品列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加控制器"><span class="toc-text">添加控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加布局、视图起始文件及视图"><span class="toc-text">添加布局、视图起始文件及视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#设置默认路由"><span class="toc-text">设置默认路由</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行应用程序"><span class="toc-text">运行应用程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#准备数据库"><span class="toc-text">准备数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建数据库"><span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Entity-Framework上下文"><span class="toc-text">创建Entity Framework上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装EF"><span class="toc-text">安装EF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建上下文类"><span class="toc-text">创建上下文类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置EF连接数据库"><span class="toc-text">配置EF连接数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Product存储库"><span class="toc-text">创建Product存储库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加分页"><span class="toc-text">添加分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分页功能"><span class="toc-text">分页功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单元测试：分页"><span class="toc-text">单元测试：分页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显示页面链接"><span class="toc-text">显示页面链接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#添加视图模型"><span class="toc-text">添加视图模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加HTML辅助器方法"><span class="toc-text">添加HTML辅助器方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单元测试：创建页面链接"><span class="toc-text">单元测试：创建页面链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加视图的模型数据"><span class="toc-text">添加视图的模型数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单元测试：页面模型视图数据"><span class="toc-text">单元测试：页面模型视图数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#显示页面链接-1"><span class="toc-text">显示页面链接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#改进URL"><span class="toc-text">改进URL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置内容样式"><span class="toc-text">设置内容样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Bootstrap包"><span class="toc-text">安装Bootstrap包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在布局中运用Bootstrap样式"><span class="toc-text">在布局中运用Bootstrap样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建分部视图"><span class="toc-text">创建分部视图</span></a></li></ol></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#ASP.NET MVC"
                           title="ASP.NET MVC">ASP.NET MVC</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://laibh.top">赖同学</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Zhendong 2021
                    <br>
                    <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhdaa.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->

<script>
    var _baId = '4cc1f2d8f3067386cc5cdb626a202900';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--wechat title img-->
<img class="wechat-title-img" src="/images/zhdaa-headimg.jpg">
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
