<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zhendong在github上的个人博客">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="alternate" type="application/atom+xml" title="Zhendong" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        数据库开发（二）T-SQL的基本使用｜Zhendong&#39;s blog
        
    </title>

    <link rel="canonical" href="https://zhdaa.github.io/2019/04/14/数据库开发（二）T-SQL的基本使用/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('/images/zhdaa-headimg.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Zhendong
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/images/post-ocean.jpg">


<style>
    
    header.intro-header {
        background-image: url('/images/post-ocean.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>数据库开发（二）T-SQL的基本使用</h1>
                    
                    <span class="meta">
                         作者 Zhendong Ho
                        <span>
                          日期 2019-04-14
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#SQL Server"
                           title="SQL Server">SQL Server</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            数据库开发（二）T-SQL的基本使用
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><p>SQL全名是<strong>结构化查询语言（Structured Query Language）</strong>，是关系数据库管理系统的标准语言。Sybase与Microsoft对标准SQL做了扩展，称为：<strong>T-SQL（Transact-SQL）</strong>。</p>
<p>SQL主要分为<strong>DDL（数据定义语言）、DML（数据操作语言）和DCL（数据库控制语言）</strong>。</p>
<h2 id="Insert语句"><a href="#Insert语句" class="headerlink" title="Insert语句"></a>Insert语句</h2><p>基本语法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into 表名(列1,列2,列3) values(值1,值2,值3)</span><br></pre></td></tr></table></figure>
<h3 id="插入非自动编号列"><a href="#插入非自动编号列" class="headerlink" title="插入非自动编号列"></a>插入非自动编号列</h3><p>自动编号列，默认就会自动增长，所以不需要（默认情况下也不能向自动编号列插入值）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into Departments(DepartmentName) values(&apos;研发部&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="省略列名插入"><a href="#省略列名插入" class="headerlink" title="省略列名插入"></a>省略列名插入</h3><p>如果向表中的所有列（除了自动编号外）都要插入值，那么可以省略列名，同时保证后面的值列表中的顺序必须与表中列的顺序一致。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into Employees</span><br><span class="line">values(&apos;13031507&apos;, &apos;Zhendong&apos;, &apos;true&apos;, &apos;2013-7-1&apos;, 24, &apos;广州市&apos;, &apos;13800138000&apos;, &apos;10120&apos;, &apos;xxx@mail.com&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="插入部分列"><a href="#插入部分列" class="headerlink" title="插入部分列"></a>插入部分列</h3><p>插入部分列，允许为NULL的列可以不插入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into TblStudent(tSName,tSgender,tsage)</span><br><span class="line">values(&apos;Zhendong&apos;, &apos;男&apos;, 24)</span><br></pre></td></tr></table></figure>
<h3 id="向自动编号列插入值"><a href="#向自动编号列插入值" class="headerlink" title="向自动编号列插入值"></a>向自动编号列插入值</h3><p>默认情况下，不允许向自动编号列插入值。但是可以通过启动“手动插入自动编号列”功能向自动编号列插入值。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--启动某个表的“自动编号列”手动插入值的功能</span><br><span class="line">SET IDENTITY_INSERT TbClass ON</span><br><span class="line">insert into TblClass(tClassId,tClassName)</span><br><span class="line">values(500,&apos;A班&apos;)</span><br><span class="line">SET IDENTITY_INSERT TbClass OFF</span><br></pre></td></tr></table></figure>
<h3 id="字符串前面带N"><a href="#字符串前面带N" class="headerlink" title="字符串前面带N"></a>字符串前面带N</h3><p>在SQL语句中的直接写的字符串中，如果包含中文，一定要在字符串前面加N，否则插入后可能会乱码（与数据库排序规则有关）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into Table_2 values(N&apos;史蒂夫&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="Update语句"><a href="#Update语句" class="headerlink" title="Update语句"></a>Update语句</h2><p>基本语法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">update 表名 set 列1 = 新值1, 列2 = 新值2, ... where 条件</span><br></pre></td></tr></table></figure>
<h3 id="打开和关闭查询结果窗口"><a href="#打开和关闭查询结果窗口" class="headerlink" title="打开和关闭查询结果窗口"></a>打开和关闭查询结果窗口</h3><p>打开和关闭查询结果窗口：ctrl + R。</p>
<h3 id="更新语句"><a href="#更新语句" class="headerlink" title="更新语句"></a>更新语句</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">update TblStudent set tsAge = tsAge - 1, tsname = tsname + &apos;（男）&apos; where tsgender = &apos;男&apos;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：update语句，如果不加where条件，那么表示对表中所有的数据都进行修改，所以一定要加where条件。</p>
<h2 id="删除数据语句"><a href="#删除数据语句" class="headerlink" title="删除数据语句"></a>删除数据语句</h2><h3 id="Delete语句"><a href="#Delete语句" class="headerlink" title="Delete语句"></a>Delete语句</h3><p>基本语法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delete from 表名 where ...</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：delete语句，如果不加where条件，表示将表中所有数据删除。加where条件后，会按照where条件进行删除。另外，使用delete语句删除后，自动编号并没有恢复到默认值，仍然继续编号。</p>
<h3 id="Truncate语句"><a href="#Truncate语句" class="headerlink" title="Truncate语句"></a>Truncate语句</h3><p>如果确实要删除表中全部数据，那么建议用truncate。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">truncate table 表名</span><br></pre></td></tr></table></figure>
<p><strong>truncate特点</strong>：</p>
<ol>
<li>truncate语句不能跟where条件（无法根据条件来删除，只能删除全部数据）。</li>
<li>自动编号恢复到初始值。</li>
<li>使用truncate删除表中所有数据要比delete效率高得多。</li>
<li>truncate删除数据，不触发delete触发器。</li>
</ol>
<h2 id="通过设计器实现约束"><a href="#通过设计器实现约束" class="headerlink" title="通过设计器实现约束"></a>通过设计器实现约束</h2><h3 id="常用约束"><a href="#常用约束" class="headerlink" title="常用约束"></a>常用约束</h3><p><strong>非空约束</strong>。</p>
<p><strong>主键约束</strong>（PK）primary key constraint，唯一且不为空。</p>
<p><strong>唯一约束</strong>（UQ）unique constraint，唯一，允许为空，但只能出现一次。</p>
<p><strong>默认约束</strong>（DF）default constraint，默认值。</p>
<p><strong>检查约束</strong>（CK）check constraint，范围以及格式限制。</p>
<p><strong>外键约束</strong>（FK）foreign key constraint，表关系。</p>
<h3 id="设计器实现约束"><a href="#设计器实现约束" class="headerlink" title="设计器实现约束"></a>设计器实现约束</h3><ul>
<li>主键约束、非空约束，可以在表设计器中直接修改后保存即可。</li>
<li>唯一约束，<strong>在设计器中，右键，索引/键，添加，类型改为唯一键，选择唯一列EmpEmail（ASC），名称改为UQ_Employees_EmpEmail，点击关闭后保存</strong>。</li>
<li>检查约束，<strong>在设计器中，右键，CHECK约束，添加，名称改为CK_Employees_EmpAge，表达式中填写“EmpAge&gt;=18 and EmpAge&lt;=60”，关闭后保存</strong>。</li>
<li>默认约束，<strong>在设计器中，选中列EmpGender，常规，默认值或绑定，填写’男’，保存</strong>。</li>
<li>外键约束，<strong>在外键表设计器中，右键，选择关系，添加，点击表和列规范，选择外键表和主键表以及对应的列，点击关闭后保存</strong>。</li>
<li>当主键表中的记录在外检表中有引用的时候，无法删除主键表的记录（也无法删除主键表）。只有在外键表中没有任何引用的时候才能删掉。</li>
<li>如果希望删除<strong>主键表中的记录，同时删除外键表引用的所有记录</strong>，则需要修改外键表的约束。<strong>选择外键表，右键，关系，INSERT和UPDATE规范，删除规则，改成级联，点击保存</strong>。</li>
</ul>
<p><strong>注意</strong>：</p>
<ol>
<li>创建约束时，如果表中已经存在“非法数据”（与约束不一致的数据），那么此时是无法成功创建约束的，需要先将表中的数据做更改，然后才能创建约束。</li>
<li>主键约束和唯一约束的区别，主键约束不允许重复并且不允许为空，唯一约束不允许重复，但是允许有一个空值。</li>
</ol>
<h2 id="通过T-SQL实现约束"><a href="#通过T-SQL实现约束" class="headerlink" title="通过T-SQL实现约束"></a>通过T-SQL实现约束</h2><h3 id="手动删除一列"><a href="#手动删除一列" class="headerlink" title="手动删除一列"></a>手动删除一列</h3><p>删除EmpAddress列。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees drop column EmpAddress</span><br></pre></td></tr></table></figure>
<h3 id="手动增加一列"><a href="#手动增加一列" class="headerlink" title="手动增加一列"></a>手动增加一列</h3><p>增加一列EmpAddr nvarchar(1000)。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add EmpAddr nvarchar(1000)</span><br></pre></td></tr></table></figure>
<h3 id="修改列的数据类型"><a href="#修改列的数据类型" class="headerlink" title="修改列的数据类型"></a>修改列的数据类型</h3><p>修改一下EmpEmail的数据类型varchar(200)。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees alter column EmpEmail varchar(200)</span><br></pre></td></tr></table></figure>
<h3 id="增加主键约束"><a href="#增加主键约束" class="headerlink" title="增加主键约束"></a>增加主键约束</h3><p>为EmpId增加一个主键约束。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint PK_Employees_EmpId primary key(EmpId)</span><br></pre></td></tr></table></figure>
<h3 id="增加非空约束"><a href="#增加非空约束" class="headerlink" title="增加非空约束"></a>增加非空约束</h3><p>为EmpName增加一个非空约束，<strong>修改列的方式</strong>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees alter column EmpName varchar(50) not null</span><br></pre></td></tr></table></figure>
<h3 id="增加唯一约束"><a href="#增加唯一约束" class="headerlink" title="增加唯一约束"></a>增加唯一约束</h3><p>为EmpName增加一个唯一约束。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint UQ_Employees_EmpName unique(EmpName)</span><br></pre></td></tr></table></figure>
<h3 id="增加默认约束"><a href="#增加默认约束" class="headerlink" title="增加默认约束"></a>增加默认约束</h3><p>为EmpGender增加一个默认约束，默认为“男”。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint DF_Employees_EmpGender default(&apos;男&apos;) for EmpGender</span><br></pre></td></tr></table></figure>
<h3 id="增加检查约束"><a href="#增加检查约束" class="headerlink" title="增加检查约束"></a>增加检查约束</h3><p>为EmpGender增加一个检查约束，要求性别只能是“男”或“女”。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint CK_Employees_EmpGender check(EmpGender=&apos;男&apos; or EmpGender=&apos;女&apos;)</span><br></pre></td></tr></table></figure>
<p>为EmpAge增加一个检查约束，要求年龄必须在0-120岁之间。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint CK_Employees_EmpAge check(EmpAge&gt;=0 and EmpAge&lt;=120)</span><br></pre></td></tr></table></figure>
<h3 id="增加外键约束"><a href="#增加外键约束" class="headerlink" title="增加外键约束"></a>增加外键约束</h3><p>为员工表增加外键约束（部门表为主键表，DepId）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add constraint FK_Employees_Department foreign key(EmpDepId) references Department(DepId)</span><br></pre></td></tr></table></figure>
<h3 id="删除约束"><a href="#删除约束" class="headerlink" title="删除约束"></a>删除约束</h3><p>一次性删除多个（一个）约束。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees drop constraint FK_Employees_Department, CK_Employees_EmpAge, CK_Employees_EmpGender, DF_Employees_EmpGender, UQ_Employees_EmpName</span><br></pre></td></tr></table></figure>
<h3 id="通过一条代码增加多个约束"><a href="#通过一条代码增加多个约束" class="headerlink" title="通过一条代码增加多个约束"></a>通过一条代码增加多个约束</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alter table Employees add</span><br><span class="line">constraint FK_Employees_Department foreign key(EmpDepId) references Department(DepId),</span><br><span class="line">constraint CK_Employees_EmpAge check(EmpAge&gt;=0 and EmpAge&lt;=120),</span><br><span class="line">constraint CK_Employees_EmpGender check(EmpGender=&apos;男&apos; or EmpGender=&apos;女&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="创建表的同时就为表增加约束"><a href="#创建表的同时就为表增加约束" class="headerlink" title="创建表的同时就为表增加约束"></a>创建表的同时就为表增加约束</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create table Employees</span><br><span class="line">(</span><br><span class="line">    EmpId int identity(1, 1) primary key,</span><br><span class="line">    EmpName varchar(50) not null unique check(len(EmpName)&gt;2),</span><br><span class="line">    EmpGender char(2) default(&apos;男&apos;),</span><br><span class="line">    EmpAge int check(EmpAge&gt;0 and EmpAge&lt;120),</span><br><span class="line">    EmpEmail varchar(100) unique,</span><br><span class="line">    EmpAddress varchar(500) not null,</span><br><span class="line">    EmpDepId int foreign key references Department(EmpId) on delete cascade--允许级联删除</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">create table Department</span><br><span class="line">(</span><br><span class="line">    DepId int identity(1, 1) primary key,</span><br><span class="line">    DepName varchar(50) not null unique</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="数据检索"><a href="#数据检索" class="headerlink" title="数据检索"></a>数据检索</h2><h3 id="查询所有行所有列"><a href="#查询所有行所有列" class="headerlink" title="查询所有行所有列"></a>查询所有行所有列</h3><p>*表示显示所有列，查询语句没有加where条件表示查询所有行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent</span><br></pre></td></tr></table></figure>
<h3 id="只查询表中的部分列"><a href="#只查询表中的部分列" class="headerlink" title="只查询表中的部分列"></a>只查询表中的部分列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select tsid, tsname, tsgender from TblStudent</span><br></pre></td></tr></table></figure>
<h3 id="根据条件，只查询部分行"><a href="#根据条件，只查询部分行" class="headerlink" title="根据条件，只查询部分行"></a>根据条件，只查询部分行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent where tsclassId = 5</span><br></pre></td></tr></table></figure>
<h3 id="为查询结果中的列起列名"><a href="#为查询结果中的列起列名" class="headerlink" title="为查询结果中的列起列名"></a>为查询结果中的列起列名</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select</span><br><span class="line">    tsid as 学生编号,</span><br><span class="line">    tsname as 学生姓名,</span><br><span class="line">    tsgender as 性别</span><br><span class="line">from TblStudent</span><br><span class="line"></span><br><span class="line">/*省略as的方式，或用引号括起来*/</span><br><span class="line">select</span><br><span class="line">    tsid &apos;(学生编号)&apos;,</span><br><span class="line">    tsname 学生姓名,</span><br><span class="line">    tsgender 性别</span><br><span class="line">from TblStudent</span><br><span class="line"></span><br><span class="line">/*列名在前面*/</span><br><span class="line">select</span><br><span class="line">    学生编号=tsid,</span><br><span class="line">    学生姓名=tsname,</span><br><span class="line">    性别=tsgender</span><br><span class="line">from TblStudent</span><br></pre></td></tr></table></figure>
<h3 id="单独使用select"><a href="#单独使用select" class="headerlink" title="单独使用select"></a>单独使用select</h3><p>并不是说select必须配合from一起来使用，可以单独使用select。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select</span><br><span class="line">    当前系统时间 = getdate()</span><br></pre></td></tr></table></figure>
<h3 id="distinct关键字"><a href="#distinct关键字" class="headerlink" title="distinct关键字"></a>distinct关键字</h3><p>distinct关键字，针对<strong>已经查询出的结果</strong>，然后去除重复。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select distinct * from TblStudent</span><br><span class="line">--看不出效果，因为查询出的结果没有重复数据（ID不重复）</span><br><span class="line"></span><br><span class="line">select distinct tsname, tsgender, tsaddress from TblStudent</span><br><span class="line">--去重后的数据，重复记录必须是所有列都完全一样</span><br></pre></td></tr></table></figure>
<p>distinct是对<strong>查询出的整个结果集</strong>进行重复数据处理，而不是针对某一个列。</p>
<h3 id="order-by排序"><a href="#order-by排序" class="headerlink" title="order by排序"></a>order by排序</h3><p>按照年龄，降序排序。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent order by tsage desc --降序排序</span><br></pre></td></tr></table></figure>
<p>按照年龄，升序排序。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent order by tsage asc --升序排序</span><br><span class="line">select * from TblStudent order by tsage --默认就是升序排序</span><br></pre></td></tr></table></figure>
<h3 id="top关键字"><a href="#top关键字" class="headerlink" title="top关键字"></a>top关键字</h3><p>top获取前几条数据，top<strong>一般都与order by连用</strong>。</p>
<p>查询数学成绩最高的前五名。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select top 5 * from TblScore order by tMath desc</span><br></pre></td></tr></table></figure>
<p>如果top后跟的不是数字，而是一个表达式，一定要用()把表达式括起来。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select top (2*2) * from TblScore order by tMath desc</span><br></pre></td></tr></table></figure>
<p>选择前百分之三十五条，会查询出4条数据，向上取整。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select top 35 percent * from TblScore order by tMath desc</span><br></pre></td></tr></table></figure>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p><strong>MAX(最大值)、MIN(最小值)、AVG(平均值)、SUM(和)、COUNT(数量：记录的条数)。</strong></p>
<h3 id="SUM求总和"><a href="#SUM求总和" class="headerlink" title="SUM求总和"></a>SUM求总和</h3><p>统计出所有人的年龄的总和。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select sum(age) as 年龄总和 from NewPerson</span><br></pre></td></tr></table></figure>
<h3 id="COUNT求记录条数"><a href="#COUNT求记录条数" class="headerlink" title="COUNT求记录条数"></a>COUNT求记录条数</h3><p>统计出当前表中一共有多少条记录。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select count(*) from NewPerson</span><br></pre></td></tr></table></figure>
<p>计算平均年龄。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select</span><br><span class="line">	平均年龄=(select sum(age) as 年龄总和 from NewPerson)*1.0/(select count(*) from NewPerson)</span><br></pre></td></tr></table></figure>
<h3 id="MAX求最大值"><a href="#MAX求最大值" class="headerlink" title="MAX求最大值"></a>MAX求最大值</h3><p>计算年龄最大的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select max(age) from NewPerson</span><br></pre></td></tr></table></figure>
<h3 id="MIN求最小值"><a href="#MIN求最小值" class="headerlink" title="MIN求最小值"></a>MIN求最小值</h3><p>计算年龄最小的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select min(age) from NewPerson</span><br></pre></td></tr></table></figure>
<h3 id="AVG求平均值"><a href="#AVG求平均值" class="headerlink" title="AVG求平均值"></a>AVG求平均值</h3><p>计算平均值avg</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select avg(age*1.0) from NewPerson</span><br></pre></td></tr></table></figure>
<h3 id="聚合函数的一些问题"><a href="#聚合函数的一些问题" class="headerlink" title="聚合函数的一些问题"></a>聚合函数的一些问题</h3><ol>
<li>聚合函数不统计空值。</li>
<li>如果使用聚合函数的时候，没有手动group by分组，那么聚合函数会把整个表中的数据作为一组来统计。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent</span><br><span class="line">select count(tsid) from TblStudent</span><br><span class="line">select avg(tsage) from TblStudent --avg()也是不统计空值的</span><br><span class="line">select sum(tsage) from TblStudent --sum()对于null值，认为是0</span><br></pre></td></tr></table></figure>
<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="select…from…where…"><a href="#select…from…where…" class="headerlink" title="select…from…where…"></a>select…from…where…</h3><p><strong>select 列 from 表 where 条件。</strong></p>
<p>查询没有及格的学生的学号。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select tsid from TblScore where tEnglish&lt;60 or tMath&lt;60</span><br></pre></td></tr></table></figure>
<p>查询年龄在20-30岁之间的男同学，包含20和30。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from MyStudent where fage&gt;=20 and fage&lt;=30 and fgender=&apos;男&apos;</span><br></pre></td></tr></table></figure>
<h3 id="between…and…"><a href="#between…and…" class="headerlink" title="between…and…"></a>between…and…</h3><p><strong>在…之间，闭区间，包含两个端点值。</strong></p>
<p>查询math成绩在80-90分之间的所有学生。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblScore where tMath between 80 and 90</span><br></pre></td></tr></table></figure>
<h3 id="in和or"><a href="#in和or" class="headerlink" title="in和or"></a>in和or</h3><p>查询班级id为1、2、3的所有学生。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent where tsClassId=3 or tsClassId=4 tsClassId=5 --or与in只是写法不同</span><br><span class="line">select * from TblStudent where tsClassId in (3,4,5) --in比or看起来更加简便</span><br></pre></td></tr></table></figure>
<p><strong>对于in或者or查询，如果查询中的条件是连续的几个数字，最好用&gt;=、&lt;=或者between…and，不要使用or或者in。可以提高效率。</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent where tsClassId&gt;=3 and tsClassId&lt;=5</span><br></pre></td></tr></table></figure>
<h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><p>like表示模糊查询。</p>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><p><strong>_：表示任意的单个字符</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--姓张，两个字</span><br><span class="line">select * from MyStudent where fname like &apos;张_&apos;</span><br><span class="line">--姓张，三个字</span><br><span class="line">select * from MyStudent where fname like &apos;张__&apos;</span><br></pre></td></tr></table></figure>
<p><strong>%：匹配任意多个任意字符</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--姓张，无论姓名字数</span><br><span class="line">select * from MyStudent where fname like &apos;张%&apos;</span><br><span class="line">--姓张，两个字（与_实现效果一样）</span><br><span class="line">select * from MyStudent where fname like &apos;张%&apos; and len(fname)=2</span><br></pre></td></tr></table></figure>
<p><strong>[ ]：表示筛选，范围</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--中间是数字的</span><br><span class="line">select * from TblStudent where tsname like &apos;张[0-9]妹&apos;</span><br><span class="line">--中间是字母的</span><br><span class="line">select * from TblStudent where tsname like &apos;张[a-z]妹&apos;</span><br><span class="line">--中间是数字或者字母的</span><br><span class="line">select * from TblStudent where tsname like &apos;张[a-z0-9]妹&apos;</span><br><span class="line">--中间不是数字的任意字符</span><br><span class="line">select * from TblStudent where tsname like &apos;张[^0-9]妹&apos;</span><br></pre></td></tr></table></figure>
<p><strong>转义</strong>：通配符放到[]中就转义了，就不会认为是通配符了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--查询出姓名包含%的人</span><br><span class="line">select * from TblStudent where tsname like &apos;%[%]%&apos;</span><br></pre></td></tr></table></figure>
<p><strong>另外，还可以自己制定转义符。</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--自己指定一个转义符/</span><br><span class="line">--查询出名字中包含]的人</span><br><span class="line">select * from TblStudent where tsname like &apos;%/]%&apos; ESCAPE &apos;/&apos;</span><br><span class="line">--查询出名字中包含[的人</span><br><span class="line">select * from TblStudent where tsname like &apos;%/[%&apos; ESCAPE &apos;/&apos;</span><br><span class="line">--查询出名字中包含[...]的人</span><br><span class="line">select * from TblStudent where tsname like &apos;%/[%/]%&apos; ESCAPE &apos;/&apos;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：like &apos;a%&apos; 与 like &apos;%a&apos; 的区别，前者效率比后者效率高，因为使用了索引。</p>
<h2 id="空值处理"><a href="#空值处理" class="headerlink" title="空值处理"></a>空值处理</h2><p><strong>null值无法使用=和&lt;&gt;来进行比较。判断null值必须使用is null或者is not null。</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from TblStudent where tsage is not null</span><br><span class="line">select * from TblStudnet where tsage is null</span><br></pre></td></tr></table></figure>
<p>任何值与null进行计算，得到的结果还是null。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 2000 + null</span><br></pre></td></tr></table></figure>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/04/25/（转）理解javascript中的立即执行函数-function/" data-toggle="tooltip" data-placement="top"
                           title="（转）理解javascript中的立即执行函数(function(){})()">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/03/25/数据库开发（一）SQLServer基础/" data-toggle="tooltip" data-placement="top"
                           title="数据库开发（一）SQLServer基础">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL语句"><span class="toc-text">SQL语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Insert语句"><span class="toc-text">Insert语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#插入非自动编号列"><span class="toc-text">插入非自动编号列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#省略列名插入"><span class="toc-text">省略列名插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入部分列"><span class="toc-text">插入部分列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#向自动编号列插入值"><span class="toc-text">向自动编号列插入值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串前面带N"><span class="toc-text">字符串前面带N</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update语句"><span class="toc-text">Update语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#打开和关闭查询结果窗口"><span class="toc-text">打开和关闭查询结果窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新语句"><span class="toc-text">更新语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除数据语句"><span class="toc-text">删除数据语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Delete语句"><span class="toc-text">Delete语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Truncate语句"><span class="toc-text">Truncate语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过设计器实现约束"><span class="toc-text">通过设计器实现约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用约束"><span class="toc-text">常用约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设计器实现约束"><span class="toc-text">设计器实现约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过T-SQL实现约束"><span class="toc-text">通过T-SQL实现约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手动删除一列"><span class="toc-text">手动删除一列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手动增加一列"><span class="toc-text">手动增加一列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改列的数据类型"><span class="toc-text">修改列的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加主键约束"><span class="toc-text">增加主键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加非空约束"><span class="toc-text">增加非空约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加唯一约束"><span class="toc-text">增加唯一约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加默认约束"><span class="toc-text">增加默认约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加检查约束"><span class="toc-text">增加检查约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#增加外键约束"><span class="toc-text">增加外键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除约束"><span class="toc-text">删除约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过一条代码增加多个约束"><span class="toc-text">通过一条代码增加多个约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建表的同时就为表增加约束"><span class="toc-text">创建表的同时就为表增加约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据检索"><span class="toc-text">数据检索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询所有行所有列"><span class="toc-text">查询所有行所有列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#只查询表中的部分列"><span class="toc-text">只查询表中的部分列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#根据条件，只查询部分行"><span class="toc-text">根据条件，只查询部分行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为查询结果中的列起列名"><span class="toc-text">为查询结果中的列起列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单独使用select"><span class="toc-text">单独使用select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#distinct关键字"><span class="toc-text">distinct关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by排序"><span class="toc-text">order by排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#top关键字"><span class="toc-text">top关键字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聚合函数"><span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SUM求总和"><span class="toc-text">SUM求总和</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#COUNT求记录条数"><span class="toc-text">COUNT求记录条数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAX求最大值"><span class="toc-text">MAX求最大值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MIN求最小值"><span class="toc-text">MIN求最小值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AVG求平均值"><span class="toc-text">AVG求平均值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聚合函数的一些问题"><span class="toc-text">聚合函数的一些问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#条件查询"><span class="toc-text">条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#select…from…where…"><span class="toc-text">select…from…where…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#between…and…"><span class="toc-text">between…and…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in和or"><span class="toc-text">in和or</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模糊查询"><span class="toc-text">模糊查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#通配符"><span class="toc-text">通配符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空值处理"><span class="toc-text">空值处理</span></a></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#SQL Server"
                           title="SQL Server">SQL Server</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://laibh.top">赖同学</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/zhdaa">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Zhendong 2019
                    <br>
                    <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhdaa.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->

<script>
    var _baId = '4cc1f2d8f3067386cc5cdb626a202900';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--wechat title img-->
<img class="wechat-title-img" src="/images/zhdaa-headimg.jpg">
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
