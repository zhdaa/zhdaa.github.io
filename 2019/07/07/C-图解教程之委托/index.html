<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zhendong在github上的个人博客">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="alternate" type="application/atom+xml" title="Zhendong" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        C#图解教程之委托｜Zhendong&#39;s blog
        
    </title>

    <link rel="canonical" href="https://zhdaa.github.io/2019/07/07/C-图解教程之委托/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('/images/zhdaa-headimg.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Zhendong
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/images/post-ocean.jpg">


<style>
    
    header.intro-header {
        background-image: url('/images/post-ocean.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>C#图解教程之委托</h1>
                    
                    <span class="meta">
                         作者 Zhendong Ho
                        <span>
                          日期 2019-07-07
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#C#"
                           title="C#">C#</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            C#图解教程之委托
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h2 id="什么是委托？"><a href="#什么是委托？" class="headerlink" title="什么是委托？"></a>什么是委托？</h2><p><strong>委托是持有一个或多个方法的对象。但委托与典型的对象不同，执行委托，就是执行委托对象所“持有”的方法</strong>。</p>
<p><img src="13-2.jpg" alt="13-2"></p>
<p><strong>注意</strong>：</p>
<ul>
<li>方法的列表称为<strong>调用列表</strong>。</li>
<li>委托保存的方法可以来自任何类或结构，只要<strong>委托的返回类型，委托的签名（包括ref和out修饰符）和方法相匹配。</strong></li>
<li>调用列表中的方法<strong>可以是实例方法，也可以是静态方法</strong>。</li>
<li>在调用委托的时候，会执行其调用列表中的<strong>所有</strong>方法。</li>
</ul>
<h3 id="方法签名"><a href="#方法签名" class="headerlink" title="方法签名"></a>方法签名</h3><p>方法的签名组成：<strong>方法的名称、参数的数目、参数的数据类型和顺序、参数修饰符</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">AddValues</span>(<span class="params"><span class="keyword">int</span> a, <span class="keyword">int</span> b</span>) </span>&#123; &#125; </span><br><span class="line"><span class="comment">//long不是签名的一部分</span></span><br><span class="line"><span class="comment">//AddValues(int a, int b) 为签名部分</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li><strong>返回值类型</strong>不是签名的一部分。</li>
<li><strong>形参的名称</strong>不是签名的一部分。</li>
</ul>
<h2 id="如何使用委托"><a href="#如何使用委托" class="headerlink" title="如何使用委托"></a>如何使用委托</h2><ol>
<li>声明一个委托类型。</li>
<li>使用该委托类型声明一个委托变量。</li>
<li>为委托类型增加方法。</li>
<li>调用委托执行方法。</li>
</ol>
<p><img src="13-1.jpg" alt="13-1"></p>
<h3 id="声明委托类型"><a href="#声明委托类型" class="headerlink" title="声明委托类型"></a>声明委托类型</h3><p>语法：<strong>delegate 返回类型 委托类型名(签名);</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//关键字 返回类型 委托类型名(签名);</span></span><br><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">int</span> x</span>)</span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li>委托类型的声明和方法的声明相似，<strong>有返回类型和签名</strong>，但是<strong>委托没有方法主体</strong>。</li>
<li>委托类型<strong>不需要在类内部声明</strong>。</li>
</ul>
<h3 id="创建委托对象并赋值"><a href="#创建委托对象并赋值" class="headerlink" title="创建委托对象并赋值"></a>创建委托对象并赋值</h3><p>在委托类型声明之后，可以声明变量并创建类型的对象。</p>
<p><strong>有两种创建委托对象的方式</strong>：</p>
<ol>
<li>使用带new运算符的对象创建表达式。</li>
<li>使用快捷语法，即方法说明符“=”。</li>
</ol>
<p><strong>通过new运算符创建对象</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">int</span> x</span>)</span>;	<span class="comment">//声明委托类型</span></span><br><span class="line"></span><br><span class="line">Mydel deVar, dVar;	<span class="comment">//创建两个委托变量</span></span><br><span class="line">deVar = <span class="keyword">new</span> MyDel(myInstObj.MyM1);	<span class="comment">//创建委托并保存引用（实例方法）</span></span><br><span class="line">dVar = <span class="keyword">new</span> MyDel(SClass.OtherM2);	<span class="comment">//创建委托并保存引用（静态方法）</span></span><br></pre></td></tr></table></figure>
<p><strong>通过方法说明符创建对象</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">int</span> x</span>)</span>;	<span class="comment">//声明委托类型</span></span><br><span class="line"></span><br><span class="line">Mydel deVar, dVar;	<span class="comment">//创建两个委托变量</span></span><br><span class="line">deVar = myInstObj.MyM1;	<span class="comment">//创建委托并保存引用（实例方法）</span></span><br><span class="line">dVar = SClass.OtherM2;	<span class="comment">//创建委托并保存引用（静态方法）</span></span><br></pre></td></tr></table></figure>
<h3 id="委托的恒定性"><a href="#委托的恒定性" class="headerlink" title="委托的恒定性"></a>委托的恒定性</h3><p><strong>组合委托</strong>：可以使用运算符<strong>“+=”为委托增加方法</strong>，或使用运算符<strong>“-=”为委托移除方法</strong>。</p>
<p>为委托增加和移除方法，看起来像是委托被修改了，其实它们并没有被修改。事实上，<strong>委托是恒定的。委托对象被创建后不能再被改变</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">MyDel delVar = inst.MyM1;	<span class="comment">//创建并初始化</span></span><br><span class="line">delVar += SC1.M3;	<span class="comment">//增加方法</span></span><br><span class="line">delVar += X.Act;	<span class="comment">//增加方法</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>在为委托增加和移除方法时实际发生的是<strong>创建了一个新的委托</strong>，其调用列表是增加和移除后的方法结果。</p>
<p><img src="13-6.jpg" alt="13-6"></p>
<h2 id="委托的示例"><a href="#委托的示例" class="headerlink" title="委托的示例"></a>委托的示例</h2><h3 id="简单带参数委托DEMO"><a href="#简单带参数委托DEMO" class="headerlink" title="简单带参数委托DEMO"></a>简单带参数委托DEMO</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span>;	<span class="comment">//声明委托类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintLow</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125; - Low Value"</span>, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintHigh</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125; - High Value"</span>, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Program program = <span class="keyword">new</span> Program();</span><br><span class="line">        MyDel del;	<span class="comment">//声明委托变量</span></span><br><span class="line">        <span class="comment">//创建随机整数生成器对象，并得到0到99之间的一个随机数</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> randomValue = rand.Next(<span class="number">99</span>);</span><br><span class="line">        <span class="comment">//创建一个包含PrintLow或PrintHigh的委托对象，并将其赋值给del变量</span></span><br><span class="line">        del = randomValue &lt; <span class="number">50</span></span><br><span class="line">            ? <span class="keyword">new</span> MyDel(program.PrintLow)</span><br><span class="line">            : <span class="keyword">new</span> MyDel(program.PrintHigh);</span><br><span class="line">        del(randomValue);	<span class="comment">//执行委托</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="简单无参数多方法列表委托DEMO"><a href="#简单无参数多方法列表委托DEMO" class="headerlink" title="简单无参数多方法列表委托DEMO"></a>简单无参数多方法列表委托DEMO</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义一个没有返回值和参数的委托类型</span></span><br><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">PrintFunction</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Print1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"Print1 -- instance"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">static</span> <span class="title">Print2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"Print2 -- static"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Test t1 = <span class="keyword">new</span> Test();	<span class="comment">//创建一个测试类实例</span></span><br><span class="line">        PrintFunction pf;		<span class="comment">//创建一个空委托</span></span><br><span class="line">        </span><br><span class="line">        pf = t.Print1;		<span class="comment">//实例化并初始化该委托</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//给委托增加3个另外的方法</span></span><br><span class="line">        pf += Test.Print2;</span><br><span class="line">        pf += t.Print1;</span><br><span class="line">        pf += Test.Print2;</span><br><span class="line">        <span class="comment">//现在，委托含有4个方法</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != pf)	<span class="comment">//确认委托有方法</span></span><br><span class="line">        &#123;</span><br><span class="line">            pf();	<span class="comment">//调用委托</span></span><br><span class="line">            <span class="comment">//Print1 -- instance</span></span><br><span class="line">            <span class="comment">//Print2 -- static</span></span><br><span class="line">            <span class="comment">//Print1 -- instance</span></span><br><span class="line">            <span class="comment">//Print2 -- static</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"Delegate is empty"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="带返回值的委托DEMO"><a href="#带返回值的委托DEMO" class="headerlink" title="带返回值的委托DEMO"></a>带返回值的委托DEMO</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">int</span> <span class="title">MyDel</span>(<span class="params"></span>)</span>;	<span class="comment">//声明有返回值的方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> IntValue = <span class="number">5</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Add2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IntValue += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> IntValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Add3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IntValue += <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">return</span> IntValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyClass mc = <span class="keyword">new</span> MyClass();</span><br><span class="line">        MyDel mDel = mc.Add2;	<span class="comment">//创建并初始化委托</span></span><br><span class="line">        mDel += mc.Add3;		<span class="comment">//增加方法</span></span><br><span class="line">        mDel += mc.Add2;		<span class="comment">//增加方法</span></span><br><span class="line">        Console.WriteLine(<span class="string">"Value: &#123;0&#125;"</span>, mDel());	<span class="comment">//Value: 12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="带引用参数的委托"><a href="#带引用参数的委托" class="headerlink" title="带引用参数的委托"></a>带引用参数的委托</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">ref</span> <span class="keyword">int</span> x</span>)</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add2</span>(<span class="params"><span class="keyword">ref</span> <span class="keyword">int</span> x</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add3</span>(<span class="params"><span class="keyword">ref</span> <span class="keyword">int</span> x</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x += <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyClass mc = <span class="keyword">new</span> MyClass();</span><br><span class="line">        </span><br><span class="line">        MyDel mDel = mc.Add2;</span><br><span class="line">        mDel += mc.Add3;</span><br><span class="line">        mDel += mc.Add2;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">5</span>;</span><br><span class="line">        mDel(<span class="keyword">ref</span> x);</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">"Value: &#123;0&#125;"</span>, x);	<span class="comment">//Value: 12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="匿名方法"><a href="#匿名方法" class="headerlink" title="匿名方法"></a>匿名方法</h2><p><strong>匿名方法（anonymous method）</strong>是在初始化委托时内联声明的方法。</p>
<p><strong>何时使用</strong>：当一个方法只会被调用一次的时候，没有必要创建独立的具名方法，这个时候可以使用匿名方法。</p>
<p>命名方法：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Add20</span>(<span class="params"><span class="keyword">int</span> x</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">delegate</span> <span class="keyword">int</span> <span class="title">OtherDel</span>(<span class="params"><span class="keyword">int</span> InParam</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        OtherDel del = Add20;</span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, del(<span class="number">5</span>));	<span class="comment">//25</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, del(<span class="number">6</span>));	<span class="comment">//26</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>匿名方法：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">delegate</span> <span class="keyword">int</span> <span class="title">OtherDel</span>(<span class="params"><span class="keyword">int</span> InParam</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        OtherDel del = <span class="keyword">delegate</span>(<span class="keyword">int</span> x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> x + <span class="number">20</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, del(<span class="number">5</span>));	<span class="comment">//25</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, del(<span class="number">6</span>));	<span class="comment">//26</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用匿名方法"><a href="#使用匿名方法" class="headerlink" title="使用匿名方法"></a>使用匿名方法</h3><p>我们可以在如下地方使用匿名方法.</p>
<ul>
<li>声明委托变量时作为初始化表达式。</li>
<li>组合委托时在赋值语句的右边。</li>
<li>为委托增加事件时在赋值语句的右边。（第十四章会介绍事件）</li>
</ul>
<h3 id="匿名方法的语法"><a href="#匿名方法的语法" class="headerlink" title="匿名方法的语法"></a>匿名方法的语法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">关键字     参数列表         语句块</span><br><span class="line">  ↓           ↓              ↓</span><br><span class="line">delegate (Parameters) &#123; ImplementationCode &#125;</span><br></pre></td></tr></table></figure>
<h4 id="返回类型"><a href="#返回类型" class="headerlink" title="返回类型"></a>返回类型</h4><p>匿名方法<strong>不会显式声明返回类型</strong>。但是如果委托类型有返回值，则实现代码必须返回一个与委托的返回类型相匹配的值。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">int</span> <span class="title">OtherDel</span>(<span class="params"><span class="keyword">int</span> InParam</span>)</span>;	<span class="comment">// 委托类型的返回值为int</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OtherDel del = <span class="keyword">delegate</span>(<span class="keyword">int</span> x)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>  x + <span class="number">20</span>;		<span class="comment">// 返回一个int类型的值</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>匿名方法的参数列表中的<strong>参数数量、参数类型及位置、修饰符</strong>必须与委托类型的参数列表匹配。</p>
<p><strong>注意</strong>：如果委托的参数列表<strong>不包含任何out参数</strong>，并且<strong>匿名方法没有使用任何参数</strong>，则匿名方法<strong>可以省略参数列表</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">SomeDel</span>(<span class="params"><span class="keyword">int</span> x</span>)</span>;		<span class="comment">// 声明委托类型</span></span><br><span class="line">SomeDel sDel = <span class="keyword">delegate</span>		<span class="comment">// 省略的参数列表</span></span><br><span class="line">&#123;</span><br><span class="line">    PrintMessage();</span><br><span class="line">    Cleanup();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="params参数"><a href="#params参数" class="headerlink" title="params参数"></a>params参数</h4><p>如果委托声明的参数列表包含了params参数，那么匿名方法的参数列表将忽略params参数关键字。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">SomeDel</span>(<span class="params"><span class="keyword">int</span> x, <span class="keyword">params</span> <span class="keyword">int</span>[] y</span>)</span>;	<span class="comment">// 在委托类型声明中使用params关键字</span></span><br><span class="line">SomeDel mDel = <span class="keyword">delegate</span>(<span class="keyword">int</span> x, <span class="keyword">int</span>[] y)		<span class="comment">// 在匹配的匿名方法中省略params关键字</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="变量和参数的作用域"><a href="#变量和参数的作用域" class="headerlink" title="变量和参数的作用域"></a>变量和参数的作用域</h3><p>参数以及声明在匿名方法内部的局部变量，作用域限制在实现方法的内部。</p>
<h4 id="外部变量"><a href="#外部变量" class="headerlink" title="外部变量"></a>外部变量</h4><p>与委托的具名方法不同，<strong>匿名方法可以访问它们外围作用域的局部变量和环境</strong>。外围作用域的变量叫做<strong>外部变量（outer variable）</strong>。用在匿名方法实现代码中的外部变量称为<strong>被方法捕获（captured）</strong>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"></span>)</span>;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">5</span>;		<span class="comment">//变量x定义在匿名方法作用域的前面</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">MyDel del = <span class="keyword">delegate</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, x);	<span class="comment">// 使用外部变量x</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="捕获变量的生命周期的扩展"><a href="#捕获变量的生命周期的扩展" class="headerlink" title="捕获变量的生命周期的扩展"></a>捕获变量的生命周期的扩展</h4><p>只要捕获方法还是委托的一部分，即使变量已经离开了作用域，捕获的外部变量也会一直有效。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">MyDel</span>(<span class="params"></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MyDel mDel;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">5</span>;	<span class="comment">// 变量x定义在外部块中，在匿名方法之外</span></span><br><span class="line">        mDel = <span class="keyword">delegate</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"Value of x: &#123;0&#125;"</span>, x);	<span class="comment">// 变量x被匿名方法捕获</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Console.WriteLine("Value of x: &#123;0&#125;", x);	// 变量x离开了作用域，如果去掉注释会报错</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != mDel)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Value of x: 5</span></span><br><span class="line">        mDel();	<span class="comment">// mDel委托中的匿名方法在它的环境中保留了x，并在调用mDel时输出了它的值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h2><p>在匿名方法的语法中，delegate关键字是有点多余，因为编译器已经知道我们在将方法赋值给委托。我们可以很容易地通过如下步骤把匿名方法转换为Lambda表达式：</p>
<ul>
<li>删除delegate关键字。</li>
<li>在参数列表和匿名方法主体之间放<strong>Lambda运算符=&gt;</strong>（读作goes to）。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">MyDel del = <span class="keyword">delegate</span>(<span class="keyword">int</span> x)    &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// 匿名方法</span></span><br><span class="line">MyDel le1 =         (<span class="keyword">int</span> x) =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// Lambda表达式</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>术语Lambda表达式来源于数学家Alonzo Church等人在1920到1930年期间发明的Lambda积分。Lambda积分是用于表示函数的一套系统，它使用希腊字母Lambda（λ）来表示无名函数。近来，函数式编程语言（如Lisp及其方言）使用这个术语来表示可以直接用于描述函数定义的表达式，表达式不再需要有名字了。</p>
</blockquote>
<p>除了这种简单的转换，通过编译器的自动推断，我们可以更进一步简化Lambda表达式。</p>
<ul>
<li>编译器还可以从委托的声明中知道委托参数的类型，因此Lambda表达式允许我们省略类型参数，如le2。<ul>
<li>带有类型的参数列表称为显式类型。</li>
<li>省略类型的参数列表称为隐式类型。</li>
</ul>
</li>
<li>如果只有一个隐式类型参数，我们可以省略周围的圆括号，如le3。</li>
<li>最后，Lambda表达式允许表达式的主体是语句块或表达式。如果语句块包含了一个返回语句，我们可以将语句块替换为return关键字后的表达式，如le4。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">MyDel del = <span class="keyword">delegate</span>(<span class="keyword">int</span> x)    &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// 匿名方法</span></span><br><span class="line">MyDel le1 =         (<span class="keyword">int</span> x) =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// Lambda表达式（显式类型）</span></span><br><span class="line">MyDel le2 =             (x) =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// Lambda表达式，省略类型参数（隐式类型）</span></span><br><span class="line">MyDel le3 =               x =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// Lambda表达式，省略隐式类型参数（只有一个）的圆括号</span></span><br><span class="line">MyDel le4 =               x =&gt;          x + <span class="number">1</span>   ;	<span class="comment">// Lambda表达式，包含返回语句，省略return关键字</span></span><br></pre></td></tr></table></figure>
<p><strong>Lambda表达式的完整示例</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">delegate</span> <span class="keyword">double</span> <span class="title">MyDel</span>(<span class="params"><span class="keyword">int</span> par</span>)</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyDel del = <span class="keyword">delegate</span>(<span class="keyword">int</span> x)    &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">// 匿名方法</span></span><br><span class="line">        </span><br><span class="line">        MyDel le1 =         (<span class="keyword">int</span> x) =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;	<span class="comment">//Lambda表达式</span></span><br><span class="line">        MyDel le2 =             (x) =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;</span><br><span class="line">        MyDel le3 =               x =&gt; &#123; <span class="keyword">return</span> x + <span class="number">1</span>; &#125;;</span><br><span class="line">        MyDel le4 =               x =&gt;          x + <span class="number">1</span>   ;</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, del(<span class="number">12</span>));	<span class="comment">// 13</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, le1(<span class="number">12</span>));	<span class="comment">// 13</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, le2(<span class="number">12</span>));	<span class="comment">// 13</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, le3(<span class="number">12</span>));	<span class="comment">// 13</span></span><br><span class="line">        Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, le4(<span class="number">12</span>));	<span class="comment">// 13</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有关Lambda表达式的参数列表的要点如下：</p>
<ul>
<li>Lambda表达式参数列表中的参数必须在参数数量、类型和位置上与委托相匹配。</li>
<li>表达式的参数列表中的参数不一定需要包含类型（隐式类型），除非委托有ref或out参数，此时必须注明类型（显式类型）。</li>
<li>如果只有一个参数，并且是隐式类型的，周围的圆括号可以被省略，否则必须有括号。</li>
<li>如果没有参数，必须使用一组空的圆括号。</li>
</ul>
<p><img src="13-16.jpg" alt="13-16"></p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/07/23/C-图解教程之事件/" data-toggle="tooltip" data-placement="top"
                           title="C#图解教程之事件">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/06/19/数据库开发（七）存储过程、事物、T-SQL编程/" data-toggle="tooltip" data-placement="top"
                           title="数据库开发（七）存储过程、事物、T-SQL编程">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是委托？"><span class="toc-text">什么是委托？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法签名"><span class="toc-text">方法签名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何使用委托"><span class="toc-text">如何使用委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#声明委托类型"><span class="toc-text">声明委托类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建委托对象并赋值"><span class="toc-text">创建委托对象并赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#委托的恒定性"><span class="toc-text">委托的恒定性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#委托的示例"><span class="toc-text">委托的示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单带参数委托DEMO"><span class="toc-text">简单带参数委托DEMO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单无参数多方法列表委托DEMO"><span class="toc-text">简单无参数多方法列表委托DEMO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带返回值的委托DEMO"><span class="toc-text">带返回值的委托DEMO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带引用参数的委托"><span class="toc-text">带引用参数的委托</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#匿名方法"><span class="toc-text">匿名方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用匿名方法"><span class="toc-text">使用匿名方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#匿名方法的语法"><span class="toc-text">匿名方法的语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#返回类型"><span class="toc-text">返回类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数"><span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#params参数"><span class="toc-text">params参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量和参数的作用域"><span class="toc-text">变量和参数的作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#外部变量"><span class="toc-text">外部变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#捕获变量的生命周期的扩展"><span class="toc-text">捕获变量的生命周期的扩展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lambda表达式"><span class="toc-text">Lambda表达式</span></a></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#C#"
                           title="C#">C#</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://laibh.top">赖同学</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Zhendong 2021
                    <br>
                    <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhdaa.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->

<script>
    var _baId = '4cc1f2d8f3067386cc5cdb626a202900';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--wechat title img-->
<img class="wechat-title-img" src="/images/zhdaa-headimg.jpg">
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
