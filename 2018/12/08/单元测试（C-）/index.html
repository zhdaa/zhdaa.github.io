<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zhendong在github上的个人博客">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="alternate" type="application/atom+xml" title="Zhendong" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        单元测试（C#）｜Zhendong&#39;s blog
        
    </title>

    <link rel="canonical" href="https://zhdaa.github.io/2018/12/08/单元测试（C-）/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('/images/zhdaa-headimg.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Zhendong
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/images/post-ocean.jpg">


<style>
    
    header.intro-header {
        background-image: url('/images/post-ocean.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>单元测试（C#）</h1>
                    
                    <span class="meta">
                         作者 Zhendong Ho
                        <span>
                          日期 2018-12-08
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#NUnit"
                           title="NUnit">NUnit</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            单元测试（C#）
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <p>单元测试，是项目成功、个人成功的一个不可或缺的部分。单元测试是相对廉价而简单的技术，但对于程序猿来说，是必须掌握的技术，因为它能够帮助我们更高效地写出质量更好的代码。</p>
<h2 id="自信的编码"><a href="#自信的编码" class="headerlink" title="自信的编码"></a>自信的编码</h2><p>下面我讲一个故事。</p>
<p>有一次——或许就是上个礼拜二——有两个开发者：Pat 和Dale。他们面临着相同的最后期限，而这一天也越来越近了。Pat 每天都在着急地编写代码，写完一个类又写一个类，写完一个函数又接着写另一个函数，还经常不得不停下来做一些调整，使得代码能够通过编译。</p>
<p>Pat 一直保持着这种工作方式，直到最后期限的前一天。而这时已经是演示所有代码的时候了。Pat 运行了最上层的程序，但是一点输出也没有，什么都没有。这时只好用调试器来单步跟踪了。“Hmm，决不可能是这样的”，Pat 想，“此时这个变量绝对不是0 啊”。于是，Pat 只能回过头来看代码，尝试着跟踪一下这个难以琢磨的程序的调用流程。</p>
<p>时间已经越来越晚了，Pat 找到并且纠正了这个bug；但在这个过程中，Pat 又找到了其他好几个bug；如此几次过后，bug 还是存在。而程序输出那边，仍然没有结果。这时，Pat 已经筋疲力尽了，完全搞不清楚为什么会这样，认为这种（没有输出的）行为是毫无道理的。</p>
<p>而于此同时，Dale 并没像Pat 那么快地写代码。Dale 在写一个函数的时候，会附带写一个简短的测试程序来测试这个函数。这里没有什么特殊的地方，只是添加了一个简单的测试，来判断函数的功能是否和程序员期望的一致。显然，考虑如何写，然后把测试写出来，是需要占用一定时间的；但是Dale 在未对刚写的函数做出确认之前，是不会接着写新代码的。也就是说，只有等到已知函数都得到确认之后，Dale 才会继续编写下一个函数，然后调用前面的函数等等。</p>
<p>在整个过程中，Dale 几乎不使用调试器；而且对Pat 的模样也有些困惑不解：只见他头埋在两手之间，嘀咕着各种难听的话语，咒骂着计算机，充血的眼球同时盯着好几个调试窗口。</p>
<p>最后期限终于到了，Pat 未能完成任务。而Dale 的代码被集成到整个系统中，并且能够很好地运行。之后，在Dale 的模块中，出现了一个小问题；但是Dale 很快就发现了问题所在，在几分钟之内就解决了问题。</p>
<p>现在，是该总结一下上面这个小故事的时候了：Dale 和Pat 的年纪相当，编码能力相当，智力也差不多。唯一的区别就是Dale 非常相信单元测试；对于每个新写的函数，在其他代码使用这个函数并对它形成依赖之前，都要先做单元测试。</p>
<p>而Pat 则没有这么做，他总是“知道”代码的行为应该和所期望的完全一样，并且等到所有代码都差不多写完的时候，才想起来运行一下代码。然而到了这个时候，要想定位bug，或者，甚至是确定哪些代码的行为是正确的，哪些代码的行为是错误的，都为时已晚了。</p>
<h2 id="什么是单元测试"><a href="#什么是单元测试" class="headerlink" title="什么是单元测试"></a>什么是单元测试</h2><p><strong>单元测试</strong>是开发者编写的一小段代码，用于检验被测代码的一个很小的、很明确的功能是否正确。</p>
<p>通常来说，我们编写的单元测试并不是针对一段代码或者一个方法，而是针对一个应用场景。即判断某个特定条件下，某个特定函数的行为是否正确。</p>
<h3 id="为什么要使用单元测试"><a href="#为什么要使用单元测试" class="headerlink" title="为什么要使用单元测试"></a>为什么要使用单元测试</h3><p>单元测试不但会使你的工作完成得更轻松，而且会令你的设计变得更好，甚至大大减少你花在调试上面的时间。</p>
<h3 id="间接损害"><a href="#间接损害" class="headerlink" title="间接损害"></a>间接损害</h3><p>间接损害是：在整个系统中，当某一部分加入了新特性，或者修复了一个Bug之后，给系统的其他（与前面可能是互不相关的）部分引入了一个新的Bug（或者损害）。如果无视这种损害并且继续开发的话，那么将可能带来一个很危险的问题，最后可能会导致整个系统崩溃，并且没人能够修复。</p>
<h2 id="如何使用NUnit进行测试"><a href="#如何使用NUnit进行测试" class="headerlink" title="如何使用NUnit进行测试"></a>如何使用NUnit进行测试</h2><h3 id="NUnit集成到Visual-Studio-2017中使用"><a href="#NUnit集成到Visual-Studio-2017中使用" class="headerlink" title="NUnit集成到Visual Studio 2017中使用"></a>NUnit集成到Visual Studio 2017中使用</h3><p>点击菜单栏工具，打开扩展和更新，联机搜索nunit，下载NUnit 3 Test Adapter、NUnit VS Template和Test Generator NUnit extension三个插件。</p>
<p><img src="1544537341991.png" alt="1544537341991"></p>
<p>下载完成后关闭Visual Studio 2017，随后弹出一个界面，点击修改按钮。修改完成后如下。</p>
<p><img src="1544371101477.png" alt="1544371101477"></p>
<p>重新打开Visual Studio 2017，此时已经可以在VS中使用NUnit了。</p>
<h3 id="使用NUnit教程"><a href="#使用NUnit教程" class="headerlink" title="使用NUnit教程"></a>使用NUnit教程</h3><p>首先在VS2017中新建一个控制台项目，取名为NUnitTest。并添加一类Cmp.cs，修改代码如下，其中包括被测试的方法。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Cmp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Largest</span>(<span class="params"><span class="keyword">int</span>[] list</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index, max = Int32.MaxValue;</span><br><span class="line">        <span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; list.Length - <span class="number">1</span>; index++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (list[index] &gt; max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = list[index];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在项目中引入NUnit。点击菜单栏工具，选中Nuget包管理器，打开程序包管理控制台，输入命令Install-Package NUnit。</p>
<p><img src="1544538493382.png" alt="1544538493382"></p>
<p>新建一个用于测试的单元测试类TestLargest.cs，修改代码如下，其中包含测试的方法。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> NUnit.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NUnitTest</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">TestFixture</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestLargest</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Test</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LargestOf3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Assert.AreEqual(<span class="number">9</span>, Cmp.Largest(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span> &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li>[TestFixture(argument)]属性标记类为测试类，若没有填写参数，则测试类必须包含无参构造函数，否则需要相应的有参构造函数。</li>
<li>[Test]属性标记方法为测试方法。</li>
</ul>
<p>点击菜单栏测试，选中窗口，打开测试资源管理器。点击运行测试。</p>
<p><img src="1544539417456.png" alt="1544539417456"></p>
<p>测试显示没有通过，结果与期望值不一致。可以查看错误的详细信息。</p>
<p><img src="1544539645117.png" alt="1544539645117"></p>
<h2 id="NUnit的各种断言"><a href="#NUnit的各种断言" class="headerlink" title="NUnit的各种断言"></a>NUnit的各种断言</h2><p>NUnit提供了一些辅助函数用于帮助你确定某个被测试函数是否工作正常。这些函数称为断言。</p>
<h3 id="AreEquals"><a href="#AreEquals" class="headerlink" title="AreEquals"></a>AreEquals</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Assert.AreEquals(expected, actual, tolerance  [, <span class="keyword">string</span> message]);</span><br></pre></td></tr></table></figure>
<p>expected：你期望的值，通常是硬编码。</p>
<p>actual：被测试代码实际产生的值。</p>
<p>message：一个可选的消息，如果提供的话，将会在发生错误时显示。</p>
<p>tolerance：误差。</p>
<h3 id="IsNull"><a href="#IsNull" class="headerlink" title="IsNull"></a>IsNull</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Assert.IsNull(<span class="keyword">object</span>, [, <span class="keyword">string</span> message]);</span><br><span class="line">Assert.IsNotNull(<span class="keyword">object</span>, [, <span class="keyword">string</span> message]);</span><br></pre></td></tr></table></figure>
<p>验证一个给定的对象是否为null（或者为非null），如果答案为否，则将会失败。message参数是可选的。</p>
<h3 id="AreSame"><a href="#AreSame" class="headerlink" title="AreSame"></a>AreSame</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Assert.AreSame(expected, actual [, <span class="keyword">string</span> message]);</span><br></pre></td></tr></table></figure>
<p>验证expected参数和actual参数所引用的是否为同一对象，如果不是，将会失败。message参数是可选的。</p>
<h3 id="IsTrue"><a href="#IsTrue" class="headerlink" title="IsTrue"></a>IsTrue</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Assert.IsTrue(<span class="keyword">bool</span> condition [, <span class="keyword">string</span> message]);</span><br><span class="line">Assert.IsFalse(<span class="keyword">bool</span> condition [, <span class="keyword">string</span> message]);</span><br></pre></td></tr></table></figure>
<p>验证给定的二元条件是否为真（假），如果为假（真）的话，将会失败。message参数是可选的。</p>
<h3 id="Fail"><a href="#Fail" class="headerlink" title="Fail"></a>Fail</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Assert.Fail([<span class="keyword">string</span> message]);</span><br></pre></td></tr></table></figure>
<p>上面的断言将会使测试立即失败，其中message参数是可选的。这种断言通常被用于标记某个不应该被到达的分支。</p>
<h3 id="使用断言"><a href="#使用断言" class="headerlink" title="使用断言"></a>使用断言</h3><p>一般而言，一个测试方法会包含有多个断言。当一个断言失败的时候，该测试方法将会被终止，从而导致该方法中剩余的断言这次就无法执行了。因此在继续测试之前先修复这个失败的测试。</p>
<h2 id="NUnit测试的组成"><a href="#NUnit测试的组成" class="headerlink" title="NUnit测试的组成"></a>NUnit测试的组成</h2><p>一个test的fixture包含一个或多个测试方法：每个方法包含一个或多个断言。一个程序集可以包含多个test fixture。</p>
<h3 id="分类（Categories）"><a href="#分类（Categories）" class="headerlink" title="分类（Categories）"></a>分类（Categories）</h3><p>NUnit用Category的概念提供了标记和运行一个个单独的测试和fixture的简单方法。</p>
<p>可以使用NUnit的Category来把运行时间较短的测试和运行时间较长的测试分开。例如，假设有许多只需要几秒钟就能完成的方法，但是另一个方法却要花费很长的时间才能运行完成。这时候可以通过使用分类名“Short”和“Long”来标记它们。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> NUnit.Framework;</span><br><span class="line"><span class="keyword">using</span> NUnit.Core;</span><br><span class="line"></span><br><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestShortestPath</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    [<span class="meta">Category(<span class="meta-string">"Short"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Use5Cities</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        TSP tsp = <span class="keyword">new</span> TSP();<span class="comment">// Load with default cities</span></span><br><span class="line">        Assert.AreEqual(<span class="number">140</span>, tsp.ShortestPath(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">Test, Category(<span class="meta-string">"Short"</span>)</span>]<span class="comment">// 另一种写法，一行多个特性</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Use10Cities</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        TSP tsp = <span class="keyword">new</span> TSP();<span class="comment">// Load with default cities</span></span><br><span class="line">        Assert.AreEqual(<span class="number">586</span>, tsp.ShortestPath(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// This one takes a while</span></span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    [<span class="meta">Category(<span class="meta-string">"Long"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Use50Cities</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        TSP tsp = <span class="keyword">new</span> TSP();<span class="comment">// Load with default cities</span></span><br><span class="line">        Assert.AreEqual(<span class="number">2300</span>, tsp.ShortestPath(<span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Per-method的Setup和TearDown"><a href="#Per-method的Setup和TearDown" class="headerlink" title="Per-method的Setup和TearDown"></a>Per-method的Setup和TearDown</h3><p>每个测试的运行都应该是互相独立的，因此可以在任何时候以任意顺序运行每个单独的测试。</p>
<p>在每个测试开始之前，需要设置某些测试环境，在测试完成之后，需要释放一些资源。</p>
<p>每个用Setup标记的方法会在每个[Test]方法之前执行，每个测试方法完成后，会调用TearDown标记的方法。</p>
<p>例如，每个测试都需要连接数据库，这时只需要在Setup和TearDown方法中分别建立和释放连接即可。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestDB</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Connection dbConn;</span><br><span class="line">    [<span class="meta">Setup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MySetup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dbConn = <span class="keyword">new</span> Connection(<span class="string">"oracle"</span>, <span class="number">1521</span>, user, pw);</span><br><span class="line">        dbConn.Connect();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">TearDown</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MyTeardown</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dbConn.Disconnect();</span><br><span class="line">        dbConn = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestAccountAccess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Uses dbConn</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestEmployeeAccess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Uses dbConn</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Per-class-Setup和Per-class-TearDown"><a href="#Per-class-Setup和Per-class-TearDown" class="headerlink" title="Per-class Setup和Per-class TearDown"></a>Per-class Setup和Per-class TearDown</h3><p>某些情况下，除了对方法设置运行环境，还需要对test class设置一些环境，以及在类中的所有方法都执行完成后做一些清理工作。只需要在声明setup方法的时候标记如下attribute。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestFixtureSetUp</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OneTimeSetUp</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">TestFixtureTearDown</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OneTimeTearDown</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义NUnit断言"><a href="#自定义NUnit断言" class="headerlink" title="自定义NUnit断言"></a>自定义NUnit断言</h3><p>在某些环境下，假如要处理一个特殊数据类型，或者处理对多个测试都共享的一系列操作时，使用自定义断言更加方便。</p>
<p>假如所有的测试都会使用一种数据类型Money。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> NUnit.Framework;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoneyAssert</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AssertNoCents</span>(<span class="params">Money amount, <span class="keyword">string</span> message</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Assert.AreEqual(amount.AsDecimal(), Decimal.Truncate(amount.AsDecimal()), message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AssertNoCents</span>(<span class="params">Money amount</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        AssertNoCents(amount, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于项目中需要测试Money类的其他测试类，都可以使用我们自己定义的断言。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> NUnit.Framework;</span><br><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestSomething</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CountDeMonet</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Money m = <span class="keyword">new</span> Money(<span class="number">42.00</span>);</span><br><span class="line">        m.Add(<span class="number">2</span>);</span><br><span class="line">        MoneyAssert.AssertNoCents(m);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="NUnit和异常"><a href="#NUnit和异常" class="headerlink" title="NUnit和异常"></a>NUnit和异常</h3><p>测试方法被期望抛出一个异常。如果没有抛出异常，测试将会失败。如果异常如预料的抛出了，测试将会通过。一旦期望的异常抛出了，那么测试方法中剩余的代码就会被跳过。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestException</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test, ExceptedException(typeof(ArgumentException))</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestForException</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        whitePage.ImportList(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="临时忽略一些测试"><a href="#临时忽略一些测试" class="headerlink" title="临时忽略一些测试"></a>临时忽略一些测试</h3><p>NUnit使用[Ignore]属性告诉测试框架，跳过该测试。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Test, Ignore(<span class="meta-string">"Not ready to test this yet"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestSomething</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试哪些内容"><a href="#测试哪些内容" class="headerlink" title="测试哪些内容"></a>测试哪些内容</h2><h3 id="Right-BICEP"><a href="#Right-BICEP" class="headerlink" title="Right-BICEP"></a>Right-BICEP</h3><p>Right-BICEP是6个值得测试的具体部位的统称，能提高我们的测试技巧。</p>
<ul>
<li><strong>Right</strong>——结果是否<strong>正确</strong>？</li>
<li><strong>B</strong>——是否所有的<strong>边界</strong>条件都是正确的？</li>
<li><strong>I</strong>——能查一下<strong>反向</strong>关联吗？</li>
<li><strong>C</strong>——能用其他手段<strong>交叉检查</strong>一下结果吗？</li>
<li><strong>E</strong>——你是否可以强制<strong>错误条件</strong>的发生？</li>
<li><strong>P</strong>——是否满足<strong>性能</strong>要求？</li>
</ul>
<h3 id="结果是否正确"><a href="#结果是否正确" class="headerlink" title="结果是否正确"></a>结果是否正确</h3><h4 id="使用数据文件"><a href="#使用数据文件" class="headerlink" title="使用数据文件"></a>使用数据文件</h4><p>对于许多有大量测试数据的测试，可以考虑用一个独立的数据文件来存储这些测试数据，然后用单元测试读取该文件。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> NUnit.Framework;</span><br><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestLargestDataFile</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//TestLargest的一个版本，从一个测试文件中读取所有测试数据</span></span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestFromFile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">string</span> line;</span><br><span class="line">        StreamReader rdr = <span class="keyword">new</span> StreamReader(<span class="string">"../../testdata.txt"</span>);</span><br><span class="line">        <span class="keyword">while</span> ((line = rdr.ReadLine()) != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (line.StartWith(<span class="string">"#"</span>))<span class="comment">//忽略注释</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">string</span>[] tokens = line.Split(<span class="literal">null</span>);</span><br><span class="line">            <span class="comment">//读取期望值</span></span><br><span class="line">            <span class="keyword">string</span> val = tokens[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> expected = <span class="keyword">int</span>.Parse(val);</span><br><span class="line">            <span class="comment">//添加Largest函数的参数</span></span><br><span class="line">            ArrayList argument_list	= <span class="keyword">new</span> ArrayList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tokens.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                argument_list.Add(<span class="keyword">int</span>.Parse(tokens[i]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//转化为原生数组</span></span><br><span class="line">            <span class="keyword">int</span>[] args = (<span class="keyword">int</span>[])argument_list.ToArray(<span class="keyword">typeof</span>(<span class="keyword">int</span>));</span><br><span class="line">            <span class="comment">//运行断言</span></span><br><span class="line">            Assert.AreEqual(expected, Cmp.Largest(args));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="边界条件"><a href="#边界条件" class="headerlink" title="边界条件"></a>边界条件</h3><p>一想到可能的边界条件的简单办法就是记住助记短语CORRECT，对于其中每一条，想想是否存在于被测试方法中的某个条件非常类似。</p>
<ul>
<li>Conformance（一致性）——值是否和预期的一致。</li>
<li>Ordering（顺序性）——值是否如应该的那样，是有序或者无序的。</li>
<li>Range（区间性）——值是否位于合理的最小值和最大值之内。</li>
<li>Reference（依赖性）——代码是否引用了一些不在代码本身控制范围之内的外部资源。</li>
<li>Existence（存在性）——值是否存在（例如，是否为非null，非0，在一个集合中等等）。</li>
<li>Cardinality（基数性）——是否恰好有足够的值？</li>
<li>Time（相对或者绝对的时间性）——所有事情的发生是否有序的？是否在正确的时刻？是否恰好及时？</li>
</ul>
<h3 id="检查反向关联"><a href="#检查反向关联" class="headerlink" title="检查反向关联"></a>检查反向关联</h3><p>对于一些方法，我们可以使用反向的逻辑关系来验证它们。例如，可以用对结果进行平方的方式来检查一个计算平方根的函数，然后测试结果是否和原数据很接近。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SquareRootUsingInverse</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> x = MyMath.SquareRoot(<span class="number">4.0</span>);</span><br><span class="line">    Assert.AreEqual(<span class="number">4.0</span>, x*x, <span class="number">0.0001</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类似地，为了检查某条记录是否成功地插入数据库，也可以通过查询这条记录来验证，等待。</p>
<h3 id="使用其他手段来实现交叉检查"><a href="#使用其他手段来实现交叉检查" class="headerlink" title="使用其他手段来实现交叉检查"></a>使用其他手段来实现交叉检查</h3><p>计算一个量会有一种以上的算法。我们可能会基于运行效率或者其他的特性来选择算法。</p>
<p>在测试系统中，可以使用算法中的一个来交叉测试结果。</p>
<p>我们可以充分利用一些比较弱的版本来检查我们新写的超级漂亮的版本，看它们是否产生了相同的结果。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SquareRootUsingStd</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> number = <span class="number">3880900.0</span>;</span><br><span class="line">    <span class="keyword">double</span> root1 = MyMath.SquareRoot(number);</span><br><span class="line">    <span class="keyword">double</span> root2 = Math.Sqrt(number);</span><br><span class="line">    Assert.AreEqual(root2, root1, <span class="number">0.0001</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="强制产生错误条件"><a href="#强制产生错误条件" class="headerlink" title="强制产生错误条件"></a>强制产生错误条件</h3><p>在真实世界中，错误总是会发生：磁盘会满，网络连接会断开，电子邮件会多得像掉进了黑洞，而程序会崩溃。你应当能够通过强制引发错误，来测试你的代码是如何处理所有这些真实世界中的问题的。</p>
<p>可能存在的环境方面的约束有：</p>
<ul>
<li>内存耗光。</li>
<li>磁盘用满。</li>
<li>时钟出问题。</li>
<li>网络不可用或者有问题。</li>
<li>系统过载。</li>
<li>受限的调色板。</li>
<li>显式分辨率过高或者过低。</li>
</ul>
<h2 id="边界条件-1"><a href="#边界条件-1" class="headerlink" title="边界条件"></a>边界条件</h2><p>代码中的许多Bugs都出现在“边界条件”附近，也就是说，在那些条件下，代码的行为可能不同于平常的、每天都能运行到的程序路径。</p>
<h3 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h3><p>很多时候，你所期望的或产生的数据必须符合某种特定的格式。比如一个e-mail地址并不仅仅是一个简单的字符串。你期望e-mail地址是这样的格式：<a href="mailto:name@somewhere.com" target="_blank" rel="noopener">name@somewhere.com</a></p>
<p>必须要考虑到：如果数据不能像你期望的那样与结构相一致，将会出现什么情况。这时就需要测试结果并确保其一致性。</p>
<h3 id="有序性"><a href="#有序性" class="headerlink" title="有序性"></a>有序性</h3><p>另一个需要考虑的方面是数据的顺序，或者是在一个很大的数据集合中某一数据的位置。</p>
<p>有序性的一个方面是：任何一种搜索程序都应该针对搜索目标位于最前或者最后的条件做测试，因为许多常见的Bug在这种情况下都能找出来。</p>
<p>有序性的另一个方面：如果你的方法是让某些元素维持有序，就应该检查一下它们是否真的有序。</p>
<p>假设有一个方法，负责把点菜菜单发送到厨房，那么应该做一个测试来保证菜单上的菜目顺序符合正确的上菜顺序（沙拉、主菜、甜点）：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">KitchenOrder</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Order order = <span class="keyword">new</span> Order();</span><br><span class="line">    FoodItem dessert = <span class="keyword">new</span> Dessert(<span class="string">"Chocolate Decadence"</span>);</span><br><span class="line">    FoodItem entree = <span class="keyword">new</span> Entree(<span class="string">"Beef Oscar"</span>);</span><br><span class="line">    FoodItem salad = <span class="keyword">new</span> Salad(<span class="string">"Paramesan Peppercorn"</span>);</span><br><span class="line">    <span class="comment">//加菜单</span></span><br><span class="line">    order.AddFoodItem(dessert);</span><br><span class="line">    order.AddFoodItem(entree);</span><br><span class="line">    order.AddFoodItem(salad);</span><br><span class="line">    <span class="comment">//但还是应该按照上菜的顺序送上来</span></span><br><span class="line">    IEnumerator itr = order.GetEnumerator();</span><br><span class="line">    Assert.AreEqual(salad, itr.Current);</span><br><span class="line">    itr.MoveNext();</span><br><span class="line">    Assert.AreEqual(entree, itr.Current);</span><br><span class="line">    itr.MoveNext();</span><br><span class="line">    Assert.AreEqual(dessert, itr.Current);</span><br><span class="line">    itr.MoveNext();</span><br><span class="line">    <span class="comment">//菜都上完了</span></span><br><span class="line">    Assert.IsPalse(itr.MoveNext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="区间性"><a href="#区间性" class="headerlink" title="区间性"></a>区间性</h3><p>Range是一个针对所有类似下列情景的单词：对于一个变量，它所属类型的取值范围可能比你需要或想要的更加宽广。</p>
<p>例如，通常用整型表示一个人的岁数，显然20000岁是合法的整型数，但不是合理的。用整型来存储角度，在一个圆中，角度值不会大于360度。</p>
<p>假设有一个维护了两对x，y坐标的类。坐标值都属于整型，并且可以具有任意值；但是，区间具有如下约束：两个点必须能够描述一个所有边都不大于100个unit的矩形。也就是说，这两对x，y值的允许区间是相互依赖的。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> MAX_DIST = <span class="number">100</span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AssertPairInRange</span>(<span class="params">Point one, Point two, <span class="keyword">string</span> message</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Assert.IsTure(Math.Abs(one.X - two.X) &lt;= MAX_DIST, message);</span><br><span class="line">    Assert.IsTure(Math.Abs(one.Y - two.Y) &lt;= MAX_DIST, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>几乎所有的索引概念（无论是否为整型索引）都应该被大量的测试。</p>
<ul>
<li>开始索引和结束索引有相同的值。</li>
<li>第一个索引值大于最后一个索引值。</li>
<li>索引值是负的。</li>
<li>索引值大于允许值。</li>
<li>Count不能匹配确切索引的个数。</li>
</ul>
<h3 id="引用-耦合性"><a href="#引用-耦合性" class="headerlink" title="引用/耦合性"></a>引用/耦合性</h3><p>如果对于类的状态、其他对象的状态，或者全局应用程序的状态，你需要做一些假设，那么你就需要对代码进行测试，保证其在假设未满足的情况下运行良好。</p>
<p>例如，汽车微处理控制传动器的代码可能有一组用来检查一下特殊情况的测试：传动器的状态（是否切换到停车档）取决于汽车的状态（处于移动状态还是停车状态）。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">JamItIntoPark</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    transmission.Shift(DRIVE);<span class="comment">//传动器切换到移动状态</span></span><br><span class="line">    car.AccelerateTo(<span class="number">35</span>);<span class="comment">//加速</span></span><br><span class="line">    Assert.AreEqual(DRIVER, transmission.CurrentGear);<span class="comment">//ok</span></span><br><span class="line">    <span class="comment">// should silently ignore</span></span><br><span class="line">    transmission.Shift(PARK);<span class="comment">//切换到停车状态</span></span><br><span class="line">    Assert.AreEqual(DRIVER, transmission.CurrentGear);<span class="comment">//ok</span></span><br><span class="line">    </span><br><span class="line">    car.AccelerateTo(<span class="number">0</span>);<span class="comment">//减速</span></span><br><span class="line">    car.BreakToStop();</span><br><span class="line">    <span class="comment">// should work now</span></span><br><span class="line">    transmission.Shift(PARK);</span><br><span class="line">    Assert.AreEqual(PARK, transmission.CurrentGear);<span class="comment">//fail</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个已知方法的<strong>前条件</strong>是指：系统必须处于什么状态下，该方法才能运行。在上面的例子中，使传动器停止的前条件就是汽车的发动机必须停止。因此我们需要确认：当前条件不能满足的时候，程序的行为仍然是正确的。</p>
<p>在方法的最后，<strong>后条件</strong>是指：你的方法将会保证哪些状态发生。程序直接返回的结果显然是要检查的，但如果程序具有任何副作用，那你也需要对它们进行检查。</p>
<h3 id="存在性"><a href="#存在性" class="headerlink" title="存在性"></a>存在性</h3><p>对于你传入或者维护的值，先询问自己如果值不存在——如果它为null，或者为空，或者等于0，方法的行为将会怎么样？</p>
<p>因此，你要确认你已经做了足够的测试：null、0、空字符串和其他与存在性相关的陷阱。</p>
<p>确认你的方法处理了“不存在”的情况。</p>
<h3 id="基数性"><a href="#基数性" class="headerlink" title="基数性"></a>基数性</h3><p>这是一个和存在性相关的问题，但是你现在需要确信：你计算得到的数目和你所需要的数目是一致的。</p>
<p>测试专注于0、1、n这样的边界条件上，其中n的数值也很可能会随着业务需求而变化。</p>
<h3 id="时间性"><a href="#时间性" class="headerlink" title="时间性"></a>时间性</h3><p>边界条件中，与时间相关的方面包括：</p>
<ul>
<li>相对时间（时间上的顺序）。</li>
<li>绝对时间（消耗的时间和钟表上的时间）。</li>
<li>并发问题。</li>
</ul>
<ol>
<li>一些接口会拥有自己的状态；因此，为了维持这些内部状态，你期望Login()会在Logout()之前被调用，PrepareStatement()会在ExecuteStatement()之前被调用，Connect()在Read()之前被调用，而Read()又在Close()之前被调用。</li>
<li>相对时间也许还包括代码中的超时问题：为了获得一个存活期较短的资源，你的函数会等待多长时间。</li>
<li>一年中的每一天不一定是24小时。</li>
<li>要是有多个线程同时使用同一个对象，会出现什么问题（并发访问和同步访问）。</li>
</ol>
<h2 id="使用Mock对象"><a href="#使用Mock对象" class="headerlink" title="使用Mock对象"></a>使用Mock对象</h2><p>单元测试的目标是只验证一个方法。但是如果测试代码依赖于系统的其他部分，甚至系统的多个其他部分，诸如网络、数据库等。为了给某一测试创造足够的运行环境，这样不仅消耗了时间，还给测试过程引入了大量的耦合因素。</p>
<h3 id="Mock对象"><a href="#Mock对象" class="headerlink" title="Mock对象"></a>Mock对象</h3><p>Mock对象是真实对象在调试期的替代品。</p>
<p>真实对象存在的问题：</p>
<ul>
<li>真实对象具有不可确定的行为（产生不可预测的结果，如股票行情）。</li>
<li>真实对象很难被创建。</li>
<li>真实对象的某些行为很难触发（如网络错误）。</li>
<li>真实对象令程序的运行速度很慢。</li>
<li>真实对象有（或者是）用户界面。</li>
<li>测试需要询问真实对象它是如何被调用的。</li>
<li>真实对象实际上并不存在。</li>
</ul>
<p>使用Mock对象进行测试的时候，有三个步骤：</p>
<ol>
<li>使用一个接口来描述这个对象。</li>
<li>为产品代码实现这个接口。</li>
<li>以测试为目的，在Mock对象中实现这个接口</li>
</ol>
<h3 id="MockDemo"><a href="#MockDemo" class="headerlink" title="MockDemo"></a>MockDemo</h3><p>先创建针对真实环境因素的几个对象，其中一个因素就是当前时间：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">Environmental</span></span><br><span class="line">&#123;</span><br><span class="line">    DateTime Now</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PlayWavFile</span>(<span class="params"><span class="keyword">string</span> v</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写真实的实现代码：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SystemEnvironment</span> : <span class="title">Environmental</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DateTime Now</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DateTime.Now;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayWavFile</span>(<span class="params"><span class="keyword">string</span> v</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mock实现：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MockSystemEnvironment</span> : <span class="title">Environmental</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> SoundWasPlayed = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> DateTime CurrentTime;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MockSystemEnvironment</span>(<span class="params">DateTime when</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CurrentTime = when;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime Now</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> CurrentTime;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">IncrementMinutes</span>(<span class="params"><span class="keyword">int</span> minutes</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CurrentTime = CurrentTime.AddMinutes(minutes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayWavFile</span>(<span class="params"><span class="keyword">string</span> fileName</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SoundWasPlayed = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">CheckAndResetSound</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">value</span> = SoundWasPlayed;</span><br><span class="line">        SoundWasPlayed = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Checker类：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Checker</span></span><br><span class="line">&#123;</span><br><span class="line">    Environmental env;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Checker</span>(<span class="params">Environmental env</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.env = env;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reminder</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DateTime now = env.Now;</span><br><span class="line">        <span class="keyword">if</span> (now.Hour &gt;= <span class="number">17</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            env.PlayWavFile(<span class="string">"quit_whistle.wav"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestChecker</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">QuittingTime</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DateTime when = <span class="keyword">new</span> DateTime(<span class="number">2018</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">16</span>, <span class="number">55</span>, <span class="number">00</span>);</span><br><span class="line">        MockSystemEnvironment env;</span><br><span class="line">        env = <span class="keyword">new</span> MockSystemEnvironment(when);</span><br><span class="line">        Checker checker = <span class="keyword">new</span> Checker(env);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// No alarm sounds at 16:55</span></span><br><span class="line">        checker.Reminder();</span><br><span class="line">        Assert.IsFalse(env.CheckAndResetSound(), <span class="string">"16:55"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Now try 17:00</span></span><br><span class="line">        env.IncrementMinutes(<span class="number">5</span>);</span><br><span class="line">        checker.Reminder();</span><br><span class="line">        Assert.IsTrue(env.CheckAndResetSound(), <span class="string">"17:00"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// And finally 19:00</span></span><br><span class="line">        env.IncrementMinutes(<span class="number">120</span>);</span><br><span class="line">        checker.Reminder();</span><br><span class="line">        Assert.IsTrue(env.CheckAndResetSound(), <span class="string">"19:00"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用Moq框架"><a href="#使用Moq框架" class="headerlink" title="使用Moq框架"></a>使用Moq框架</h3><p>假定现在要做一个计算器提供基本运算和不同货币的转换。</p>
<p>首先定义一个计算器接口：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 计算器接口，提供基本的算数运算和不同货币的转换</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICalculator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Add</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Subtract</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Multipy</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Divide</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">ConvertUSDToRMB</span>(<span class="params"><span class="keyword">int</span> unit</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义人民币转换美元的接口：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 人民币转美元的接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUSD_RMB_ExchangeRateFeed</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetActualUSDValue</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Calculator的实现类，其中人民币转美元的接口实例以构造函数参数的形式传给Calculator类：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Calculator</span> : <span class="title">ICalculator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IUSD_RMB_ExchangeRateFeed _feed;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Calculator</span>(<span class="params">IUSD_RMB_ExchangeRateFeed feed</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	_feed = feed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">region</span> ICalculator Members</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Add</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Subtract</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Multipy</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Divide</span>(<span class="params"><span class="keyword">int</span> param1, <span class="keyword">int</span> param2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> param1 / param2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ConvertUSDToRMB</span>(<span class="params"><span class="keyword">int</span> unit</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> unit * <span class="keyword">this</span>._feed.GetActualUSDValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试Divide方法的测试代码：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">TestFixture</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CalculatorTester</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//定义mock的逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> IUSD_RMB_ExchangeRateFeed <span class="title">prvGetMockExchangeRateFeed</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Mock&lt;IUSD_RMB_ExchangeRateFeed&gt; mockObject = <span class="keyword">new</span> Mock&lt;IUSD_RMB_ExchangeRateFeed&gt;();</span><br><span class="line">        mockObject.Setup(m =&gt; m.GetActualUSDValue()).Returns(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> mockObject.Object;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//测试Divide方法</span></span><br><span class="line">    [<span class="meta">Test(Description = <span class="meta-string">"Divide 9 by 3. Expect result is 3."</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TC1_Divide9By3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IUSD_RMB_ExchangeRateFeed feed = <span class="keyword">this</span>.prvGetMockExchangeRateFeed();</span><br><span class="line">        ICalculator calculator = <span class="keyword">new</span> Calculator(feed);</span><br><span class="line">        <span class="keyword">int</span> actualResult = calculator.Divide(<span class="number">9</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">int</span> expectedResult = <span class="number">3</span>;</span><br><span class="line">        Assert.AreEqual(expectedResult, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="meta">Test(Description = <span class="meta-string">"Divide any number by zero. Should throw an System.DivideByZeroException exception."</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TC2_DivideByZero</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IUSD_RMB_ExchangeRateFeed feed = <span class="keyword">this</span>.prvGetMockExchangeRateFeed();</span><br><span class="line">        ICalculator calculator = <span class="keyword">new</span> Calculator(feed);</span><br><span class="line">        Assert.Throws(<span class="keyword">typeof</span>(System.DivideByZeroException), () =&gt; calculator.Divide(<span class="number">9</span>, <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="meta">Test(Description = <span class="meta-string">"Convert 1 USD to RMB. Expected result is 500."</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TC3_ConvertUSDToRMBTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IUSD_RMB_ExchangeRateFeed feed = <span class="keyword">this</span>.prvGetMockExchangeRateFeed();</span><br><span class="line">        ICalculator calculator = <span class="keyword">new</span> Calculator(feed);</span><br><span class="line">        <span class="keyword">int</span> actualResult = calculator.ConvertUSDToRMB(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> expectedResult = <span class="number">500</span>;</span><br><span class="line">        Assert.AreEqual(expectedResult, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ul>
<li>prvGetMockExchangeRateFeed方法用于构造一个IUSD_RMB_ExchangeRateFeed接口的Mock对象（模拟真实对象）。</li>
<li>mockObject.Setup(m =&gt; m.GetActualUSDValue()).Returns(500)，设置Mock对象中GetActualUSDValue方法的返回值为500，这样的好处是不需要对IUSD_RMB_ExchangeRateFeed接口进行实现。</li>
<li>NUnit3以后的版本不支持ExpectedException特性，用Assert.Throws()代替。</li>
</ul>
<h2 id="好的测试所具有的品质"><a href="#好的测试所具有的品质" class="headerlink" title="好的测试所具有的品质"></a>好的测试所具有的品质</h2><p>单元测试如果使用不当会浪费你的大量的时间，从而对项目造成巨大的影响。另一方面，如果没有恰当地编写和实现单元测试，在维护和调试这些测试上面，很容易就会浪费很多时间，从而影响产品代码和整个项目。</p>
<p>好的测试应该具有以下品质，合称为A-TRIP：</p>
<ul>
<li>自动化（Automatic)。</li>
<li>彻底的（Thorough）。</li>
<li>可重复（Repeatable）。</li>
<li>独立的（Independent）。</li>
<li>专业的（Professional）。</li>
</ul>
<h3 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h3><p>单元测试需要能够被自动地运行。“自动化”至少包括两方面的含义：调用测试自动化和检查结果自动化。</p>
<ul>
<li><p>调用一个或多个单元测试必须是非常容易的，不能比在IDE中按下一个按钮或者在提示符下键入一行命令更复杂。</p>
</li>
<li><p>不要引入一个由于需要手动步骤而打破这个自动化模型的测试。对于测试需要的任何条件（数据库，网络连接等）都应该让它们成为测试自身的一个自动化组成部分（使用Mock对象）。</p>
</li>
<li><p>测试必须能够自己决定它是通过了还是失败了（让测试能够检查自身）。</p>
</li>
</ul>
<h3 id="彻底的"><a href="#彻底的" class="headerlink" title="彻底的"></a>彻底的</h3><p>好的单元测试是彻底的：它们测试了所有可能会出现问题的情况。</p>
<ul>
<li>一个极端是，对于每行代码、代码可能达到的每个分支、每个可能抛出的异常等等，都可以作为测试的对象。另一个极端是，你仅仅测试最可能的情况，边界条件、残缺和畸形数据等等。</li>
<li>Bug并不是均匀分布于源代码之中的：相反，它们更倾向扎堆于一块问题区域之中。</li>
<li>抛弃一块有很多Bug的代码并且重新编写会令开销更小、痛苦更少。</li>
</ul>
<h3 id="可重复"><a href="#可重复" class="headerlink" title="可重复"></a>可重复</h3><p>每个测试应该独立于所有其他的测试，而且还必须独立于周围的环境。目标只有一个，就是测试应该能够以任意的顺序一次又一次地运行，并且产生相同的结果。这意味着测试不能依赖于不受你直接控制的任何外部因素。</p>
<ul>
<li>在必要的时候，应该使用Mock对象来隔离测试的外界因素，并且使测试能够独立于环境。</li>
<li>每个测试应当每次产生相同的结果。如果没有，那么它应当告诉你代码中存在真正的Bug。</li>
</ul>
<h3 id="独立的"><a href="#独立的" class="headerlink" title="独立的"></a>独立的</h3><p>测试应该是简洁而且精炼的，这意味着每个测试都应该有很强的针对性，并且独立于环境和其他测试。</p>
<ul>
<li>在编写测试时，确保你一次只测试了一样东西。（一个测试函数应该专注于产品代码中的一个函数，或者组合起来并共同提供某个特性的一组函数）</li>
<li>一个测试函数可能仅仅测试了产品代码中的一个复杂函数的一小部分，此时你可能需要多个测试函数来完全彻底地验证该函数。</li>
<li>理想情况下，你能够在潜在的Bugs和测试代码之间有可跟踪的对应关系。（当一个测试失败了，应该立刻就可以知道代码中潜在Bugs的位置。</li>
<li>“独立的”还意味着没有测试依赖于任何其他的测试；你应当可以在任何时候以任意顺序运行任何单个测试。</li>
</ul>
<h3 id="专业的"><a href="#专业的" class="headerlink" title="专业的"></a>专业的</h3><p>你为单元测试编写的代码是真实的，这意味着必须使用和产品代码相同的专业水准来编写和维护测试代码。</p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/01/03/（转）深入浅出JavaScript运行机制/" data-toggle="tooltip" data-placement="top"
                           title="（转）深入浅出JavaScript运行机制">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/11/23/C-6-0新用法总结/" data-toggle="tooltip" data-placement="top"
                           title="C#6.0新用法总结">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#自信的编码"><span class="toc-text">自信的编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是单元测试"><span class="toc-text">什么是单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么要使用单元测试"><span class="toc-text">为什么要使用单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#间接损害"><span class="toc-text">间接损害</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何使用NUnit进行测试"><span class="toc-text">如何使用NUnit进行测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NUnit集成到Visual-Studio-2017中使用"><span class="toc-text">NUnit集成到Visual Studio 2017中使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用NUnit教程"><span class="toc-text">使用NUnit教程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NUnit的各种断言"><span class="toc-text">NUnit的各种断言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AreEquals"><span class="toc-text">AreEquals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IsNull"><span class="toc-text">IsNull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AreSame"><span class="toc-text">AreSame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IsTrue"><span class="toc-text">IsTrue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fail"><span class="toc-text">Fail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用断言"><span class="toc-text">使用断言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NUnit测试的组成"><span class="toc-text">NUnit测试的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分类（Categories）"><span class="toc-text">分类（Categories）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Per-method的Setup和TearDown"><span class="toc-text">Per-method的Setup和TearDown</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Per-class-Setup和Per-class-TearDown"><span class="toc-text">Per-class Setup和Per-class TearDown</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义NUnit断言"><span class="toc-text">自定义NUnit断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NUnit和异常"><span class="toc-text">NUnit和异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#临时忽略一些测试"><span class="toc-text">临时忽略一些测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试哪些内容"><span class="toc-text">测试哪些内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Right-BICEP"><span class="toc-text">Right-BICEP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#结果是否正确"><span class="toc-text">结果是否正确</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用数据文件"><span class="toc-text">使用数据文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#边界条件"><span class="toc-text">边界条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查反向关联"><span class="toc-text">检查反向关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用其他手段来实现交叉检查"><span class="toc-text">使用其他手段来实现交叉检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强制产生错误条件"><span class="toc-text">强制产生错误条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#边界条件-1"><span class="toc-text">边界条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一致性"><span class="toc-text">一致性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有序性"><span class="toc-text">有序性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区间性"><span class="toc-text">区间性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#引用-耦合性"><span class="toc-text">引用/耦合性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存在性"><span class="toc-text">存在性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基数性"><span class="toc-text">基数性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间性"><span class="toc-text">时间性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用Mock对象"><span class="toc-text">使用Mock对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mock对象"><span class="toc-text">Mock对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MockDemo"><span class="toc-text">MockDemo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Moq框架"><span class="toc-text">使用Moq框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#好的测试所具有的品质"><span class="toc-text">好的测试所具有的品质</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自动化"><span class="toc-text">自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#彻底的"><span class="toc-text">彻底的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可重复"><span class="toc-text">可重复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#独立的"><span class="toc-text">独立的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#专业的"><span class="toc-text">专业的</span></a></li></ol></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#NUnit"
                           title="NUnit">NUnit</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://laibh.top">赖同学</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Zhendong 2021
                    <br>
                    <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhdaa.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->

<script>
    var _baId = '4cc1f2d8f3067386cc5cdb626a202900';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--wechat title img-->
<img class="wechat-title-img" src="/images/zhdaa-headimg.jpg">
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
